{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "951b5870-e216-45c6-b159-34150868a46e",
            "version": "KqlParameterItem/1.0",
            "name": "HostPoolOwner",
            "label": "Host Pool",
            "type": 5,
            "isRequired": true,
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false,
              "componentIdOnly": true
            },
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "TimeRange"
          },
          {
            "id": "743106f0-1736-4ba6-bc07-be09f1fe93b3",
            "version": "KqlParameterItem/1.0",
            "name": "ShowParameters",
            "type": 1,
            "isRequired": true,
            "isHiddenWhenLocked": true,
            "criteriaData": [
              {
                "criteriaContext": {
                  "leftOperand": "HostPoolOwner",
                  "operator": "regex",
                  "rightValType": "static",
                  "rightVal": "subscription",
                  "resultValType": "static",
                  "resultVal": "No"
                }
              },
              {
                "criteriaContext": {
                  "operator": "Default",
                  "resultValType": "static",
                  "resultVal": "Yes"
                }
              }
            ],
            "timeContextFromParameter": "TimeRange"
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.desktopvirtualization/hostpools"
      },
      "conditionalVisibility": {
        "parameterName": "HostPoolOwner",
        "comparison": "isNotEqualTo",
        "value": "Microsoft_Azure_WVD"
      },
      "name": "parameters_owner"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "{SubscriptionPicked}"
        ],
        "parameters": [
          {
            "id": "9703261f-0747-4f7b-90cc-ea56093cdab2",
            "version": "KqlParameterItem/1.0",
            "name": "SubscriptionPicked",
            "label": "Subscription",
            "type": 6,
            "isRequired": true,
            "query": "where type startswith 'Microsoft.DesktopVirtualization/'\r\n    | summarize Count = count() by subscriptionId\r\n    | order by Count desc\r\n    | extend Rank = row_number()\r\n    | project value = subscriptionId, label = subscriptionId, selected = Rank == 1",
            "crossComponentResources": [
              "value::all"
            ],
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "c9d9432d-511a-4621-bca3-b4cdb0cac786",
            "version": "KqlParameterItem/1.0",
            "name": "ResourceGroupPicked",
            "label": "Resource Group",
            "type": 5,
            "isRequired": true,
            "query": "resources\r\n| where type contains  \"desktopvirtualization\"\r\n| summarize Count = count() by resourceGroup\r\n| project Label = resourceGroup, Id = resourceGroup, Selected = Count >= 0",
            "crossComponentResources": [
              "{SubscriptionPicked}"
            ],
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "f4afef09-c916-4b57-9a59-f81ba8afc4f7",
            "version": "KqlParameterItem/1.0",
            "name": "HostPoolPicked",
            "label": "Host Pool",
            "type": 5,
            "isRequired": true,
            "query": "resources\r\n| where type == \"microsoft.desktopvirtualization/hostpools\" and resourceGroup == \"{ResourceGroupPicked}\"",
            "crossComponentResources": [
              "{SubscriptionPicked}"
            ],
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "6216b81d-2bba-4991-a01d-94a3419a9c17",
            "version": "KqlParameterItem/1.0",
            "name": "AlertNamePrefix",
            "label": "Alert Name Prefix",
            "type": 2,
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "resources\r\n| where type == \"microsoft.insights/scheduledqueryrules\"\r\n| where name contains \"{HostPoolPicked:label}\"\r\n| extend AlertPrefix=tostring(split(name,\"-\")[0])\r\n| distinct AlertPrefix",
            "crossComponentResources": [
              "{SubscriptionPicked}"
            ],
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "showDefault": false
            },
            "defaultValue": "value::all",
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "value": [
              "value::all"
            ]
          }
        ],
        "style": "pills",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources"
      },
      "conditionalVisibility": {
        "parameterName": "ShowParameters",
        "comparison": "isEqualTo",
        "value": "Yes"
      },
      "customWidth": "75",
      "name": "parameters_selected"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "links": [
          {
            "id": "15717f1e-4c46-4fcf-ad56-4896430fdc76",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Status",
            "subTarget": "status",
            "style": "link"
          },
          {
            "id": "e0c2499f-9a3e-4fe6-8d9a-772465e46dbb",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Performance",
            "subTarget": "performance",
            "style": "link"
          },
          {
            "id": "38334767-9585-4f69-9709-5b5281f04899",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Usage",
            "subTarget": "usage",
            "style": "link"
          },
          {
            "id": "4f9b3975-5577-43b8-8015-1614d0e37899",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Monitoring Configuration",
            "subTarget": "monitoring",
            "style": "link"
          }
        ]
      },
      "name": "links - 5"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "2362eb9f-ae1f-419e-8eef-11ba2d69e127",
            "version": "KqlParameterItem/1.0",
            "name": "HostPoolCriteria",
            "type": 1,
            "isHiddenWhenLocked": true,
            "criteriaData": [
              {
                "criteriaContext": {
                  "leftOperand": "ShowParameters",
                  "operator": "==",
                  "rightValType": "static",
                  "rightVal": "No",
                  "resultValType": "static",
                  "resultVal": "{HostPoolOwner}"
                }
              },
              {
                "criteriaContext": {
                  "operator": "Default",
                  "resultValType": "static",
                  "resultVal": "{HostPoolPicked}"
                }
              }
            ]
          },
          {
            "id": "2db9c637-0fbf-4f80-83c0-95698351be20",
            "version": "KqlParameterItem/1.0",
            "name": "HostPool",
            "label": "Host Pool",
            "type": 5,
            "isRequired": true,
            "query": "{\"version\":\"1.0.0\",\"content\":\"{\\\"value\\\":\\\"{HostPoolCriteria}\\\", \\\"display\\\":\\\"display\\\", \\\"selected\\\":true}\",\"transformers\":null}",
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 8
          },
          {
            "id": "c20dae5e-7242-47a3-af49-42cf010f758a",
            "version": "KqlParameterItem/1.0",
            "name": "Subscription",
            "type": 6,
            "isRequired": true,
            "query": "{\"version\":\"1.0.0\",\"content\":\"[{\\\"value\\\":\\\"{HostPool:subscription}\\\",\\\"labal\\\":\\\"lable\\\",\\\"selected\\\":1}]\",\"transformers\":null}",
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "queryType": 8
          },
          {
            "id": "5034c428-d8c7-4828-b26a-4d779f903fff",
            "version": "KqlParameterItem/1.0",
            "name": "ResourceGroup",
            "label": "Resource Group",
            "type": 5,
            "isRequired": true,
            "query": "{\"version\":\"1.0.0\",\"content\":\"[{\\\"value\\\":\\\"{HostPool:resourcegroup}\\\",\\\"labal\\\":\\\"lable\\\",\\\"selected\\\":1}]\",\"transformers\":null}",
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "queryType": 8
          },
          {
            "id": "68c44ab5-5c1d-444e-b0fc-cf781290a86c",
            "version": "KqlParameterItem/1.0",
            "name": "WVDHosts",
            "type": 5,
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GETARRAY\",\"path\":\"{HostPool}/sessionhosts?api-version=2019-01-23-preview\",\"urlParams\":[],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"\",\"columns\":[{\"path\":\"$.name\",\"columnid\":\"Name\"},{\"path\":\"$.name\",\"columnid\":\"disp\"},{\"path\":\"$.name\",\"columnid\":\"selected\"}]}}]}",
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 12
          },
          {
            "id": "a46a113f-2f83-4b50-911b-c8d1e3c515a5",
            "version": "KqlParameterItem/1.0",
            "name": "pooldiag",
            "type": 2,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/{HostPool}/providers/microsoft.insights/diagnosticSettings?api-version=2021-05-01-preview\",\"urlParams\":[],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value[*].properties\",\"columns\":[{\"path\":\"$.workspaceId\",\"columnid\":\"value\"},{\"path\":\"$.workspaceId\",\"columnid\":\"disp\"},{\"path\":\"$.workspaceId\",\"columnid\":\"selected\"}]}}]}",
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 12
          },
          {
            "id": "80452fae-0e01-4069-9458-a0adbba004ff",
            "version": "KqlParameterItem/1.0",
            "name": "poolla",
            "type": 5,
            "query": "resources\r\n| take 1\r\n| project diag=dynamic([{pooldiag}])\r\n| mv-expand diag\r\n| project tostring(diag)\r\n| where diag != 'null'\r\n| project diag, disp=diag, selected=1",
            "crossComponentResources": [
              "value::all"
            ],
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 172800000
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "b97c4544-8970-4638-8ac8-bdb6ae891683",
            "version": "KqlParameterItem/1.0",
            "name": "WVDHostsId",
            "type": 5,
            "isRequired": true,
            "multiSelect": true,
            "quote": "\"",
            "delimiter": ",",
            "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GETARRAY\",\"path\":\"{HostPool}/sessionhosts?api-version=2019-01-23-preview\",\"urlParams\":[],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"columns\":[{\"path\":\"$.properties.resourceId\",\"columnid\":\"Id\"},{\"path\":\"$.properties.resourceId\",\"columnid\":\"Disp\"},{\"path\":\"$.properties.resourceId\",\"columnid\":\"selected\"}]}}]}",
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 12
          },
          {
            "id": "cb1e18b4-a91e-4fe3-ab26-a40523477c9c",
            "version": "KqlParameterItem/1.0",
            "name": "WorkspaceId",
            "type": 1,
            "query": "resources\r\n| where type =~ \"Microsoft.Compute/virtualMachines/extensions\"and properties.type == \"MicrosoftMonitoringAgent\"\r\n| extend vmname = extract(\"(.*?)/extensions\",1, id)\r\n| where vmname in~ ({WVDHostsId})\r\n| project Value = parse_json(properties.settings).workspaceId, selected=true\r\n| limit 1",
            "crossComponentResources": [
              "value::all"
            ],
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "value": "0247f768-d842-44ed-aa8d-b84fe48e2c28"
          },
          {
            "id": "c97a1eab-9599-4343-84dd-abdb240d0f9a",
            "version": "KqlParameterItem/1.0",
            "name": "Workspace",
            "type": 5,
            "query": "resources\r\n| where type == \"microsoft.operationalinsights/workspaces\"\r\n| where properties.customerId == \"{WorkspaceId}\"",
            "crossComponentResources": [
              "value::all"
            ],
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": []
            },
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "value": null
          }
        ],
        "style": "pills",
        "queryType": 12
      },
      "conditionalVisibility": {
        "parameterName": "HostPoolOwner",
        "comparison": "isNotEqualTo",
        "value": "Microsoft_Azure_WVD"
      },
      "name": "common_parameters_general"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "WVDAgentHealthStatus\r\n| where _ResourceId =~ \"{HostPool}\"\r\n| summarize arg_max(TimeGenerated,*) by SessionHostName\r\n| project SessionHostName,Status,AllowNewSessions,ActiveSessions,InactiveSessions\r\n| join kind=leftouter(\r\nPerf\r\n| where ObjectName == \"Processor Information\" and CounterName == \"% Processor Time\" and InstanceName ==\"_Total\"\r\n| where TimeGenerated >ago(10m)\r\n| extend SessionHostName=Computer\r\n| summarize AvgCPU=avg(CounterValue) by SessionHostName\r\n| extend AvgCPU=toint(round(AvgCPU))\r\n)\r\non SessionHostName\r\n| join kind=leftouter(\r\nInsightsMetrics\r\n| where TimeGenerated >ago(10m)\r\n| where Origin == \"vm.azm.ms\"\r\n| where Namespace == \"Memory\" and Name == \"AvailableMB\"\r\n| extend AvailableMemory=toreal(Val)\r\n| extend TotalMemory = toreal(todynamic(Tags)[\"vm.azm.ms/memorySizeMB\"])\r\n| extend AvailableMemoryPercentage = (AvailableMemory / TotalMemory) * 100.0\r\n| extend UsedMemory = (TotalMemory-AvailableMemory)\r\n| extend UsedMemoryPercentage = (UsedMemory / TotalMemory) * 100\r\n| extend SessionHostName=Computer\r\n| summarize UsedMemoryPercentage=avg(UsedMemoryPercentage) by SessionHostName\r\n| extend UsedMemoryPercentage=toint(round(UsedMemoryPercentage))\r\n) on SessionHostName\r\n| join kind=leftouter (\r\nPerf\r\n| where TimeGenerated > ago(15m)\r\n| where ObjectName == \"LogicalDisk\" and CounterName == \"% Free Space\"\r\n| where InstanceName == \"C:\"\r\n| where InstanceName  !contains \"_Total\"\r\n| extend PercentFreeSpace=round(CounterValue)\r\n| extend PercentUsedSpace=100-PercentFreeSpace\r\n| summarize arg_max(TimeGenerated,*) by Computer\r\n| extend SessionHostName=Computer\r\n| project SessionHostName,PercentUsedSpace\r\n)\r\non SessionHostName\r\n| project SessionHostName,Status,AllowNewSessions,ActiveSessions,InactiveSessions,AvgCPU,UsedMemoryPercentage,PercentUsedSpace",
                    "size": 3,
                    "title": "Host Status",
                    "timeContext": {
                      "durationMs": 86400000
                    },
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{poolla}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "SessionHostName",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "17.7143ch"
                          }
                        },
                        {
                          "columnMatch": "Status",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "!=",
                                "thresholdValue": "Available",
                                "representation": "4",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ],
                            "customColumnWidthSetting": "13ch"
                          }
                        },
                        {
                          "columnMatch": "AllowNewSessions",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "!=",
                                "thresholdValue": "True",
                                "representation": "critical",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ],
                            "customColumnWidthSetting": "17ch"
                          }
                        },
                        {
                          "columnMatch": "ActiveSessions",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "18.5714ch"
                          }
                        },
                        {
                          "columnMatch": "InactiveSessions",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "20.1429ch"
                          }
                        },
                        {
                          "columnMatch": "AvgCPU",
                          "formatter": 4,
                          "formatOptions": {
                            "min": 0,
                            "max": 100,
                            "palette": "coldHot",
                            "customColumnWidthSetting": "68px"
                          },
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        },
                        {
                          "columnMatch": "UsedMemoryPercentage",
                          "formatter": 4,
                          "formatOptions": {
                            "min": 0,
                            "max": 100,
                            "palette": "coldHot",
                            "customColumnWidthSetting": "122px"
                          },
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        },
                        {
                          "columnMatch": "PercentUsedSpace",
                          "formatter": 4,
                          "formatOptions": {
                            "min": 0,
                            "max": 100,
                            "palette": "greenRed",
                            "customColumnWidthSetting": "151px"
                          },
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        },
                        {
                          "columnMatch": "PercentFreeSpace",
                          "formatter": 4,
                          "formatOptions": {
                            "min": 0,
                            "max": 100,
                            "palette": "redGreen",
                            "customColumnWidthSetting": "151px"
                          },
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        }
                      ],
                      "sortBy": [
                        {
                          "itemKey": "$gen_bar_UsedMemoryPercentage_6",
                          "sortOrder": 2
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "SessionHostName",
                          "label": "Session Host"
                        },
                        {
                          "columnId": "AllowNewSessions",
                          "label": "New Sessions"
                        },
                        {
                          "columnId": "ActiveSessions",
                          "label": "Active Sessions"
                        },
                        {
                          "columnId": "InactiveSessions",
                          "label": "Inactive Sessions"
                        },
                        {
                          "columnId": "AvgCPU",
                          "label": "CPU"
                        },
                        {
                          "columnId": "UsedMemoryPercentage",
                          "label": "Used Memory"
                        },
                        {
                          "columnId": "PercentUsedSpace",
                          "label": "% Used Space (C:)"
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_bar_UsedMemoryPercentage_6",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "customWidth": "65",
                  "name": "query - 6",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "title": "   ",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "WVDAgentHealthStatus\r\n| where _ResourceId =~ \"{HostPool}\"\r\n| where TimeGenerated > ago(30m)\r\n| extend HostPool=tostring(split(_ResourceId, \"/\")[8])\r\n| extend HostPool=tolower(HostPool)\r\n| summarize arg_max(TimeGenerated, *) by SessionHostName,HostPool\r\n| summarize\r\n    arg_max(TimeGenerated, HostPool),\r\n    ActiveSessions=sum(toint(ActiveSessions)),\r\n    InactiveSessions=sum(toint(InactiveSessions)),\r\n    HostsAllowingSessions=countif(AllowNewSessions==\"True\") by HostPool\r\n| extend TotalSessions=toint(ActiveSessions+InactiveSessions)\r\n| project ActiveSessions, InactiveSessions,TotalSessions,HostsAllowingSessions,HostPool\r\n| join (\r\nAzureDiagnostics \r\n| where Category has \"JobStreams\"\r\n    and StreamType_s == \"Output\"\r\n    and RunbookName_s == \"AvdHostPoolLogData\"\r\n| sort by TimeGenerated\r\n| where TimeGenerated > now() - 30m\r\n//| summarize arg_max(TimeGenerated, ResultDescription)\r\n| extend HostPoolName=tostring(split(ResultDescription, '|')[0])\r\n| extend MaxSessionLimit=toint(split(ResultDescription, '|')[3])\r\n| extend HostPool=tolower(HostPoolName)\r\n| summarize arg_max(TimeGenerated, *) by HostPool\r\n| project HostPool,MaxSessionLimit\r\n) on HostPool\r\n| extend TotalSessionsAllowed=HostsAllowingSessions*MaxSessionLimit\r\n| extend Used = round(((todouble(TotalSessions)/TotalSessionsAllowed)*100),0)\r\n//| project ActiveSessions,InactiveSessions, UsedCapacity\r\n| project Used\r\n| evaluate narrow()\r\n| project-away Row\r\n| extend Column = strcat(Column, \" Capacity\")",
                          "size": 3,
                          "timeContext": {
                            "durationMs": 86400000
                          },
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "Column"
                            },
                            "subtitleContent": {
                              "columnMatch": "Value",
                              "formatter": 12,
                              "formatOptions": {
                                "min": 0,
                                "max": 100,
                                "palette": "coldHot",
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": []
                                }
                              },
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": false
                                }
                              }
                            },
                            "showBorder": true
                          }
                        },
                        "name": "query - 5"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "WVDAgentHealthStatus\r\n| where _ResourceId =~ \"{HostPool}\"\r\n| where TimeGenerated >ago(30m)\r\n| extend HostPool=tostring(split(_ResourceId, \"/\")[8])\r\n| summarize arg_max(TimeGenerated, *) by SessionHostName//, bin(TimeGenerated, 1m)\r\n| summarize arg_max(TimeGenerated,HostPool),Active=sum(toint(ActiveSessions)), Inactive=sum(toint(InactiveSessions))\r\n| project Active,Inactive\r\n| evaluate narrow()\r\n| project-away Row\r\n| extend Column=strcat(Column,\" Sessions\")",
                          "size": 3,
                          "timeContext": {
                            "durationMs": 86400000
                          },
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "Column"
                            },
                            "subtitleContent": {
                              "columnMatch": "Value",
                              "formatter": 4,
                              "formatOptions": {
                                "min": 0,
                                "max": 100,
                                "palette": "yellowGreenBlue"
                              }
                            },
                            "showBorder": true
                          }
                        },
                        "name": "query - 5"
                      }
                    ]
                  },
                  "customWidth": "35",
                  "name": "tiles"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "alertsmanagementresources\r\n| extend Details = parse_json(properties).essentials\r\n| project Severity= Details.severity, id, Alert=name, Rule = tostring(Details.alertRule), State = Details.alertState, Condition=Details.monitorCondition, Time = todatetime(Details.startDateTime), Message = Details.description, TargetResource=Details.targetResource\r\n//| where Alert contains \"{AlertNamePrefix}\"\r\n| where tostring(split(Alert,\"-\")[0]) in ({AlertNamePrefix})\r\n| where Condition == \"Fired\" and State !=\"Closed\"\r\n| project Time, Severity, Alert, State, id, Rule, Condition, Message, TargetResource\r\n| sort by Time desc",
                    "size": 1,
                    "title": "Active Alerts",
                    "noDataMessage": "No Active Alerts",
                    "showExportToExcel": true,
                    "exportToExcelOptions": "all",
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Time",
                          "formatter": 6,
                          "formatOptions": {
                            "customColumnWidthSetting": "22ch"
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Sev2",
                                "representation": "Sev2",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Sev1",
                                "representation": "Sev1",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Sev3",
                                "representation": "Sev3",
                                "text": "{0}{1}"
                              },
                              {
                                "thresholdValue": "Sev4",
                                "representation": "Sev4",
                                "text": "{0}{1}"
                              },
                              {
                                "thresholdValue": "Sev0",
                                "representation": "Sev0",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": null,
                                "text": "{0}{1}"
                              }
                            ],
                            "customColumnWidthSetting": "13ch"
                          }
                        },
                        {
                          "columnMatch": "Alert",
                          "formatter": 1,
                          "formatOptions": {
                            "linkColumn": "id",
                            "linkTarget": "OpenBlade",
                            "linkIsContextBlade": true,
                            "bladeOpenContext": {
                              "bladeName": "AlertDetailsTemplateBlade",
                              "extensionName": "Microsoft_Azure_Monitoring",
                              "bladeParameters": [
                                {
                                  "name": "alertId",
                                  "source": "column",
                                  "value": "id"
                                },
                                {
                                  "name": "invokedFrom",
                                  "source": "static",
                                  "value": "emailcommonschema"
                                }
                              ]
                            },
                            "customColumnWidthSetting": "96ch"
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 5,
                          "formatOptions": {
                            "customColumnWidthSetting": "15ch"
                          }
                        },
                        {
                          "columnMatch": "id",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Rule",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Condition",
                          "formatter": 5,
                          "formatOptions": {
                            "customColumnWidthSetting": "15ch"
                          }
                        },
                        {
                          "columnMatch": "Message",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "TargetResource",
                          "formatter": 5,
                          "formatOptions": {
                            "linkTarget": "Resource",
                            "templateRunContext": {
                              "componentIdSource": "parameter",
                              "templateUriSource": "static",
                              "templateParameters": [],
                              "titleSource": "static",
                              "descriptionSource": "static",
                              "description": "",
                              "runLabelSource": "static"
                            }
                          }
                        }
                      ],
                      "rowLimit": 500,
                      "sortBy": [
                        {
                          "itemKey": "Time",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "Time",
                        "sortOrder": 2
                      }
                    ],
                    "tileSettings": {
                      "showBorder": false
                    }
                  },
                  "customWidth": "65",
                  "name": "AlertDetailsVert",
                  "styleSettings": {
                    "padding": "10px",
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let data=WVDAgentHealthStatus | extend HostPool=tostring(split(_ResourceId,\"/\")[8] )\r\n| where '{HostPool}' contains HostPool\r\n    | summarize arg_max(TimeGenerated, *) by SessionHostName, bin(TimeGenerated, 5m)\r\n    | summarize Active=sum(toint(ActiveSessions)), Inactive=sum(toint(InactiveSessions)) by TimeGenerated;\r\nlet dps=ceiling(\r\n            toscalar(data\r\n    | count) / 5000.0\r\n        );\r\ndata\r\n| summarize Active=avg(Active), Inactive=avg(Inactive) by bin(TimeGenerated, dps * 5m)",
                    "size": 1,
                    "aggregation": 5,
                    "title": "Session History (24 hours)",
                    "timeContext": {
                      "durationMs": 86400000
                    },
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{poolla}"
                    ],
                    "visualization": "barchart",
                    "chartSettings": {
                      "showMetrics": false,
                      "showLegend": true
                    }
                  },
                  "customWidth": "35",
                  "name": "query - 0",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "WVDConnections\r\n| where _ResourceId contains '{HostPool}'\r\n| summarize arg_max(TimeGenerated,*) by CorrelationId\r\n| where State == \"Connected\"\r\n| project TimeGenerated,CorrelationId,UserName,GatewayRegion\r\n| join (\r\nWVDConnectionNetworkData\r\n| where _ResourceId contains '{HostPool}'\r\n| summarize arg_max(TimeGenerated,*) by CorrelationId\r\n| project TimeGenerated,CorrelationId,EstAvailableBandwidthKBps,EstRoundTripTimeInMs\r\n ) on CorrelationId\r\n | project CorrelationId,EstAvailableBandwidthKBps,EstRoundTripTimeInMs,GatewayRegion\r\n | order by EstAvailableBandwidthKBps,EstRoundTripTimeInMs",
                    "size": 0,
                    "title": "Current Session Performance - Round Trip Time / Bandwidth",
                    "timeContext": {
                      "durationMs": 86400000
                    },
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{poolla}"
                    ],
                    "visualization": "scatterchart",
                    "chartSettings": {
                      "xAxis": "EstAvailableBandwidthKBps",
                      "yAxis": [
                        "EstRoundTripTimeInMs"
                      ],
                      "group": "GatewayRegion",
                      "createOtherGroup": null,
                      "showMetrics": false,
                      "showLegend": true,
                      "seriesLabelSettings": [
                        {
                          "seriesName": "UGAZ",
                          "label": "West Gateway (AZ)",
                          "color": "yellowDark"
                        },
                        {
                          "seriesName": "UGVI",
                          "label": "East Gateway (VI)",
                          "color": "blue"
                        },
                        {
                          "seriesName": "$_thresholdLine",
                          "color": "redBright"
                        }
                      ],
                      "customThresholdLine": "150",
                      "customThresholdLineStyle": 5,
                      "xSettings": {
                        "numberFormatSettings": {
                          "unit": 46,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true
                          }
                        }
                      },
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 23,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true
                          }
                        }
                      }
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 4"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "WVDAgentHealthStatus\r\n| where _ResourceId =~ \"{HostPool}\"\r\n| where TimeGenerated > ago(24h)\r\n| extend HostPool=tostring(split(_ResourceId, \"/\")[8])\r\n| summarize arg_max(TimeGenerated, *) by SessionHostName//, bin(TimeGenerated, 1m)\r\n| project HostPool, SessionHostName\r\n| join kind=leftouter (\r\n    Perf\r\n    | where ObjectName == \"Processor Information\"\r\n        and CounterName == \"% Processor Time\"\r\n        and InstanceName == \"_Total\"\r\n    | extend CPU=CounterValue\r\n    | project TimeGenerated, Computer, CPU\r\n| summarize CPU=avg(CPU) by bin(TimeGenerated,10m),Computer\r\n    )\r\n    on $left.SessionHostName == $right.Computer\r\n| summarize CPU=avg(CPU) by TimeGenerated,HostPool\r\n| join (\r\nWVDAgentHealthStatus\r\n| where _ResourceId =~ \"{HostPool}\"\r\n| where TimeGenerated > ago(24h)\r\n| extend HostPool=tostring(split(_ResourceId, \"/\")[8])\r\n| summarize arg_max(TimeGenerated, *) by SessionHostName//, bin(TimeGenerated, 1m)\r\n| project HostPool, SessionHostName\r\n| join kind=leftouter (\r\n    InsightsMetrics\r\n    | where Origin == \"vm.azm.ms\"\r\n    | where Namespace == \"Memory\" and Name == \"AvailableMB\"\r\n    | extend AvailableMemory=toreal(Val)\r\n    | extend TotalMemory = toreal(todynamic(Tags)[\"vm.azm.ms/memorySizeMB\"])\r\n    | extend AvailableMemoryPercentage = (AvailableMemory / TotalMemory) * 100.0\r\n    | extend UsedMemory = (TotalMemory - AvailableMemory)\r\n    | extend UsedMemoryPercentage = (UsedMemory / TotalMemory) * 100\r\n    | project TimeGenerated,Computer,UsedMemoryPercentage\r\n    | summarize UsedMemoryPercentage=avg(UsedMemoryPercentage) by bin(TimeGenerated,10m),Computer\r\n    ) on $left.SessionHostName == $right.Computer\r\n    | summarize UsedMemoryPercentage=avg(UsedMemoryPercentage) by TimeGenerated,HostPool\r\n    ) on HostPool,TimeGenerated\r\n| join kind=leftouter (\r\nWVDAgentHealthStatus\r\n| where _ResourceId =~ \"{HostPool}\"\r\n| where TimeGenerated > ago(24h)\r\n| extend HostPool=tostring(split(_ResourceId, \"/\")[8])\r\n| summarize arg_max(TimeGenerated, *) by SessionHostName//, bin(TimeGenerated, 1m)\r\n| project HostPool, SessionHostName\r\n| join kind=leftouter (\r\nPerf\r\n| where ObjectName ==\"User Input Delay per Process\"\r\n| where CounterName == \"Max Input Delay\"\r\n| where InstanceName !in (\"Max\", \"Average\") and CounterValue >0\r\n| extend InputDelay=CounterValue\r\n| project TimeGenerated,Computer,InputDelay\r\n| summarize MedianInputDelay=percentiles(InputDelay,50) by bin(TimeGenerated,10m),Computer\r\n)     on $left.SessionHostName == $right.Computer\r\n| summarize MedianInputDelay=avg(MedianInputDelay) by TimeGenerated,HostPool\r\n)on HostPool,TimeGenerated\r\n| join (\r\nWVDAgentHealthStatus | extend HostPool=tostring(split(_ResourceId,\"/\")[8] )\r\n| where '{HostPool}' contains HostPool\r\n    | summarize arg_max(TimeGenerated, *) by SessionHostName, bin(TimeGenerated, 10m),HostPool\r\n    | summarize ActiveSessions=sum(toint(ActiveSessions))by TimeGenerated,HostPool\r\n    ) on HostPool,TimeGenerated\r\n| project TimeGenerated,HostPool,CPU,UsedMemoryPercentage,MedianInputDelay,ActiveSessions\r\n\r\n\r\n",
                    "size": 0,
                    "aggregation": 5,
                    "title": "Overall Server Performance (24 hours)",
                    "timeContext": {
                      "durationMs": 86400000
                    },
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{poolla}"
                    ],
                    "visualization": "linechart",
                    "chartSettings": {
                      "xAxis": "TimeGenerated",
                      "yAxis": [
                        "ActiveSessions",
                        "CPU",
                        "MedianInputDelay",
                        "UsedMemoryPercentage"
                      ],
                      "showMetrics": false,
                      "showLegend": true
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 5"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "status"
            },
            "name": "StatusGroup"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "f18c15a0-ac39-489d-96e5-639172bc9fde",
                        "version": "KqlParameterItem/1.0",
                        "name": "TimeRange",
                        "type": 4,
                        "value": {
                          "durationMs": 172800000
                        },
                        "typeSettings": {
                          "selectableValues": [
                            {
                              "durationMs": 1800000
                            },
                            {
                              "durationMs": 3600000
                            },
                            {
                              "durationMs": 14400000
                            },
                            {
                              "durationMs": 43200000
                            },
                            {
                              "durationMs": 86400000
                            },
                            {
                              "durationMs": 172800000
                            },
                            {
                              "durationMs": 259200000
                            },
                            {
                              "durationMs": 604800000
                            },
                            {
                              "durationMs": 1209600000
                            },
                            {
                              "durationMs": 2592000000
                            }
                          ],
                          "allowCustom": true
                        },
                        "timeContextFromParameter": "TimeRange"
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "customWidth": "25",
                  "name": "parameters_timerange"
                },
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "tabs",
                    "links": [
                      {
                        "id": "15892602-dc16-417f-88ba-cdc48c4d5e5a",
                        "cellValue": "PerfTab",
                        "linkTarget": "parameter",
                        "linkLabel": "Performance Overiew",
                        "subTarget": "PerformanceOverview",
                        "style": "link"
                      },
                      {
                        "id": "c7847c03-878f-4f67-bdb2-17d4c6e5d68b",
                        "cellValue": "PerfTab",
                        "linkTarget": "parameter",
                        "linkLabel": "Disk Performance",
                        "subTarget": "DiskPerformance",
                        "style": "link"
                      },
                      {
                        "id": "518fa597-349c-434e-ba11-b10fceda6c80",
                        "cellValue": "PerfTab",
                        "linkTarget": "parameter",
                        "linkLabel": "Disk Metrics",
                        "subTarget": "DiskMetrics",
                        "style": "link"
                      }
                    ]
                  },
                  "name": "links - 2"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{HostPool}"
                          ],
                          "parameters": [
                            {
                              "id": "6f174580-6baf-4cb0-8ea8-6d739e3d5494",
                              "version": "KqlParameterItem/1.0",
                              "name": "MachineName",
                              "type": 2,
                              "multiSelect": true,
                              "quote": "'",
                              "delimiter": ",",
                              "query": "datatable (vms:dynamic)[dynamic([{WVDHosts}])]\r\n|mv-expand vms\r\n|project value=extract(\"/([^.]+)\",1,tostring(vms))\r\n| extend disp=value,selected=1\r\n",
                              "crossComponentResources": [
                                "{HostPool}"
                              ],
                              "isHiddenWhenLocked": true,
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "queryType": 0,
                              "resourceType": "microsoft.desktopvirtualization/hostpools",
                              "label": "Host"
                            },
                            {
                              "id": "e5c9cb02-5bc6-488f-8253-7c4c7c4cbe37",
                              "version": "KqlParameterItem/1.0",
                              "name": "Cores",
                              "type": 1,
                              "query": "Resources \r\n| where type =~ 'Microsoft.Compute/virtualMachines'  \r\n| where name in( {MachineName})\r\n| extend sku = tostring(properties.hardwareProfile.vmSize)\r\n| project cores = extract(\"_[[:alpha:]]+([0-9]+)\",1, sku)\r\n| top 1 by cores asc",
                              "crossComponentResources": [
                                "value::all"
                              ],
                              "isHiddenWhenLocked": true,
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources"
                            },
                            {
                              "id": "dc4a7e5b-9dd8-4035-9083-261e4e431ad2",
                              "version": "KqlParameterItem/1.0",
                              "name": "SessionLimit",
                              "type": 1,
                              "query": "resources\r\n| where id =~ \"{HostPool}\"\r\n| project MaxSession = parse_json(properties).maxSessionLimit\r\n| extend disp=\"\", selected=1",
                              "crossComponentResources": [
                                "{Subscription}"
                              ],
                              "isHiddenWhenLocked": true,
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources",
                              "label": "Session limit"
                            },
                            {
                              "id": "dca44da0-213e-4db9-865e-d799b8f1f64a",
                              "version": "KqlParameterItem/1.0",
                              "name": "SessionHostCount",
                              "type": 1,
                              "query": "datatable (vms:dynamic)[dynamic([{WVDHosts}])]\r\n|mv-expand vms\r\n|summarize count()\r\n",
                              "crossComponentResources": [
                                "{HostPool}"
                              ],
                              "isHiddenWhenLocked": true,
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "queryType": 0,
                              "resourceType": "microsoft.desktopvirtualization/hostpools",
                              "label": "Session host count"
                            },
                            {
                              "id": "1bffecf1-99e9-4443-9aa5-e1deb047ea26",
                              "version": "KqlParameterItem/1.0",
                              "name": "VSessionLimit",
                              "type": 1,
                              "isHiddenWhenLocked": true,
                              "criteriaData": [
                                {
                                  "criteriaContext": {
                                    "leftOperand": "SessionLimit",
                                    "operator": ">",
                                    "rightValType": "static",
                                    "rightVal": "1000",
                                    "resultValType": "expression",
                                    "resultVal": "{Cores}*4"
                                  }
                                },
                                {
                                  "criteriaContext": {
                                    "operator": "Default",
                                    "rightValType": "param",
                                    "resultValType": "param",
                                    "resultVal": "SessionLimit"
                                  }
                                }
                              ]
                            },
                            {
                              "id": "dcf90730-39a5-4c9d-b979-f4940e882ba0",
                              "version": "KqlParameterItem/1.0",
                              "name": "HasAgentHealthTable",
                              "type": 1,
                              "isRequired": true,
                              "query": "union isfuzzy=true ( table(\"WVDAgentHealthStatus\")| where _ResourceId =~ \"{HostPool}\" | take 1| count as Count ), (print Count=0) | summarize Result = sum(Count) \r\n| project Result = tostring(Result)\r\n",
                              "crossComponentResources": [
                                "{poolla}"
                              ],
                              "isHiddenWhenLocked": true,
                              "timeContextFromParameter": "TimeRange",
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "parameters - 4 - Copy"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "WVDAgentHealthStatus\r\n| where _ResourceId =~ \"{HostPool}\"\r\n| extend Sessions= todouble(ActiveSessions) + todouble(InactiveSessions)\r\n| make-series [\"Users/cores\"] = max(Sessions/{Cores}) on TimeGenerated step {TimeRange:grain}\r\n//| where array_length(TimeGenerated) > 0",
                          "size": 1,
                          "aggregation": 3,
                          "title": "Max users per core",
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "visualization": "timechart",
                          "chartSettings": {
                            "showMetrics": false,
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 0,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "minimumIntegerDigits": 1,
                                  "minimumSignificantDigits": 2,
                                  "maximumSignificantDigits": 2
                                }
                              },
                              "min": 0
                            }
                          }
                        },
                        "customWidth": "40",
                        "name": "MaxUserPerCore - Copy",
                        "styleSettings": {
                          "padding": "2%",
                          "showBorder": true
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "WVDAgentHealthStatus\r\n| where _ResourceId =~ \"{HostPool}\"\r\n| where TimeGenerated > ago(24h)\r\n| extend HostPool=tostring(split(_ResourceId, \"/\")[8])\r\n| summarize arg_max(TimeGenerated, *) by SessionHostName//, bin(TimeGenerated, 1m)\r\n| project HostPool, SessionHostName\r\n| join kind=leftouter (\r\n    Perf\r\n    | where ObjectName == \"Processor Information\"\r\n        and CounterName == \"% Processor Time\"\r\n        and InstanceName == \"_Total\"\r\n    | summarize CPU=avg(CounterValue) by bin(TimeGenerated, 15m), Computer\r\n    | project TimeGenerated, Computer, CPU\r\n    )\r\n    on $left.SessionHostName == $right.Computer\r\n| project TimeGenerated, Computer, CPU\r\n| render timechart with (ytitle=\" \", xtitle=\" \", ymax=100)\r\n\r\n",
                          "size": 1,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "CPU usage",
                          "noDataMessage": "No performance counters to display. Please confirm that you have enabled the performance counter collection in your Log Analytics workspace",
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "visualization": "linechart",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Computer",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "22.8571ch"
                                }
                              },
                              {
                                "columnMatch": "ProcessAverage",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": ">=",
                                      "thresholdValue": "70",
                                      "representation": "2",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": ">=",
                                      "thresholdValue": "85",
                                      "representation": "4",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ],
                                  "customColumnWidthSetting": "12.8571ch"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": false,
                                    "minimumFractionDigits": 1,
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "ProcessP95th",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "10.7143ch"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "minimumFractionDigits": 1,
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "ProcessTrend",
                                "formatter": 9,
                                "formatOptions": {
                                  "min": 0,
                                  "max": 100,
                                  "palette": "greenRed",
                                  "customColumnWidthSetting": "210px"
                                }
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "Computer",
                                "label": "Host"
                              },
                              {
                                "columnId": "ProcessAverage",
                                "label": "Average"
                              },
                              {
                                "columnId": "ProcessP95th",
                                "label": "p95"
                              },
                              {
                                "columnId": "ProcessTrend",
                                "label": "Trend"
                              }
                            ]
                          },
                          "chartSettings": {
                            "showMetrics": false,
                            "showLegend": true,
                            "ySettings": {
                              "min": 0,
                              "max": 100
                            }
                          }
                        },
                        "customWidth": "40",
                        "name": "cpu usage - Copy",
                        "styleSettings": {
                          "margin": "5px",
                          "showBorder": true
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "WVDAgentHealthStatus\r\n| where _ResourceId =~ \"{HostPool}\"\r\n| where TimeGenerated > ago(24h)\r\n| extend HostPool=tostring(split(_ResourceId, \"/\")[8])\r\n| summarize arg_max(TimeGenerated, *) by SessionHostName//, bin(TimeGenerated, 1m)\r\n| project HostPool, SessionHostName\r\n| join kind=leftouter(\r\n    Perf\r\n| where ObjectName == \"LogicalDisk\" and CounterName == \"% Free Space\"\r\n| where InstanceName == \"C:\"\r\n| where InstanceName  !contains \"_Total\"\r\n    | summarize PercentFreeSpace=avg(CounterValue) by bin(TimeGenerated, 15m), Computer\r\n    | extend PercentFreeSpace=round(PercentFreeSpace)\r\n    | extend PercentUsedSpace=100-PercentFreeSpace\r\n    | project TimeGenerated, Computer, PercentUsedSpace\r\n    )\r\n    on $left.SessionHostName == $right.Computer\r\n| project TimeGenerated, Computer, PercentUsedSpace\r\n| render timechart with (ytitle=\" \", xtitle=\" \", ymax=100)\r\n\r\n",
                          "size": 1,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Used Space % (C:)",
                          "noDataMessage": "No performance counters to display. Please confirm that you have enabled the performance counter collection in your Log Analytics workspace",
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "visualization": "linechart",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Computer",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "22.8571ch"
                                }
                              },
                              {
                                "columnMatch": "ProcessAverage",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": ">=",
                                      "thresholdValue": "70",
                                      "representation": "2",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": ">=",
                                      "thresholdValue": "85",
                                      "representation": "4",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ],
                                  "customColumnWidthSetting": "12.8571ch"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": false,
                                    "minimumFractionDigits": 1,
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "ProcessP95th",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "10.7143ch"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "minimumFractionDigits": 1,
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "ProcessTrend",
                                "formatter": 9,
                                "formatOptions": {
                                  "min": 0,
                                  "max": 100,
                                  "palette": "greenRed",
                                  "customColumnWidthSetting": "210px"
                                }
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "Computer",
                                "label": "Host"
                              },
                              {
                                "columnId": "ProcessAverage",
                                "label": "Average"
                              },
                              {
                                "columnId": "ProcessP95th",
                                "label": "p95"
                              },
                              {
                                "columnId": "ProcessTrend",
                                "label": "Trend"
                              }
                            ]
                          },
                          "chartSettings": {
                            "showMetrics": false,
                            "showLegend": true,
                            "ySettings": {
                              "min": 0,
                              "max": 100
                            }
                          }
                        },
                        "customWidth": "40",
                        "name": "cpu usage - Copy - Copy",
                        "styleSettings": {
                          "margin": "5px",
                          "showBorder": true
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "WVDAgentHealthStatus\r\n| where _ResourceId =~ \"{HostPool}\"\r\n//| where TimeGenerated > ago(30m)\r\n| where TimeGenerated > ago(24h)\r\n| extend HostPool=tostring(split(_ResourceId, \"/\")[8])\r\n| summarize arg_max(TimeGenerated, *) by SessionHostName//, bin(TimeGenerated, 1m)\r\n| project HostPool, SessionHostName\r\n| join kind=leftouter(\r\n    InsightsMetrics\r\n    | where Origin == \"vm.azm.ms\"\r\n    | where Namespace == \"Memory\" and Name == \"AvailableMB\"\r\n    | extend AvailableMemory=toreal(Val)\r\n    | extend TotalMemory = toreal(todynamic(Tags)[\"vm.azm.ms/memorySizeMB\"])\r\n    | extend AvailableMemoryPercentage = (AvailableMemory / TotalMemory) * 100.0\r\n    | extend UsedMemory = (TotalMemory - AvailableMemory)\r\n    | extend UsedMemoryPercentage = (UsedMemory / TotalMemory) * 100\r\n    | summarize UsedMemoryPercentage=avg(UsedMemoryPercentage) by bin(TimeGenerated, 15m), Computer\r\n    | project TimeGenerated, Computer, UsedMemoryPercentage\r\n    )\r\n    on $left.SessionHostName == $right.Computer\r\n| project TimeGenerated, Computer, UsedMemoryPercentage\r\n| render timechart with (ytitle=\" \", xtitle=\" \", ymax=100)\r\n\r\n",
                          "size": 1,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "% Memory Used",
                          "noDataMessage": "No performance counters to display. Please confirm that you have enabled the performance counter collection in your Log Analytics workspace",
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "visualization": "linechart",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Computer",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "22.8571ch"
                                }
                              },
                              {
                                "columnMatch": "Average",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Available",
                                      "text": "{0} {1}"
                                    },
                                    {
                                      "operator": "<=",
                                      "thresholdValue": "15",
                                      "representation": "2",
                                      "text": "{0} {1}"
                                    },
                                    {
                                      "operator": "<=",
                                      "thresholdValue": "10",
                                      "representation": "critical",
                                      "text": "{0} {1}"
                                    }
                                  ],
                                  "customColumnWidthSetting": "14.2857ch"
                                },
                                "numberFormat": {
                                  "unit": 4,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": false
                                  }
                                }
                              },
                              {
                                "columnMatch": "P5th",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "11.5714ch"
                                },
                                "numberFormat": {
                                  "unit": 4,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": false
                                  }
                                }
                              },
                              {
                                "columnMatch": "Trend",
                                "formatter": 9,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "redGreen",
                                  "customColumnWidthSetting": "220px"
                                }
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "Computer",
                                "label": "Host"
                              }
                            ]
                          },
                          "sortBy": [],
                          "chartSettings": {
                            "showMetrics": false,
                            "showLegend": true,
                            "ySettings": {
                              "min": 0,
                              "max": 100
                            }
                          }
                        },
                        "customWidth": "40",
                        "name": "Available Memory - Copy",
                        "styleSettings": {
                          "margin": "5px",
                          "showBorder": true
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "WVDAgentHealthStatus\r\n| where _ResourceId =~ \"{HostPool}\"\r\n| where TimeGenerated > ago(24h)\r\n| extend HostPool=tostring(split(_ResourceId, \"/\")[8])\r\n| summarize arg_max(TimeGenerated, *) by SessionHostName//, bin(TimeGenerated, 1m)\r\n| project HostPool, SessionHostName\r\n| join kind=leftouter (\r\n    Perf\r\n    | where ObjectName == \"PhysicalDisk\"\r\n        and CounterName == \"Avg. Disk sec/Read\"\r\n        //and InstanceName == \"_Total\"\r\n        and InstanceName contains \"C:\"\r\n    | summarize Val=avg(CounterValue) by bin(TimeGenerated, 1m), Computer\r\n    | project TimeGenerated, Computer, Val\r\n    )\r\n    on $left.SessionHostName == $right.Computer\r\n| project TimeGenerated, Computer, Val\r\n\r\n",
                          "size": 1,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Disk sec/read (C:)",
                          "noDataMessage": "No performance counters to display. Please confirm that you have enabled the performance counter collection in your Log Analytics workspace",
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "visualization": "linechart",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Computer",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "22.8571ch"
                                }
                              },
                              {
                                "columnMatch": "ProcessAverage",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": ">=",
                                      "thresholdValue": "70",
                                      "representation": "2",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": ">=",
                                      "thresholdValue": "85",
                                      "representation": "4",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ],
                                  "customColumnWidthSetting": "12.8571ch"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": false,
                                    "minimumFractionDigits": 1,
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "ProcessP95th",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "10.7143ch"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "minimumFractionDigits": 1,
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "ProcessTrend",
                                "formatter": 9,
                                "formatOptions": {
                                  "min": 0,
                                  "max": 100,
                                  "palette": "greenRed",
                                  "customColumnWidthSetting": "210px"
                                }
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "Computer",
                                "label": "Host"
                              },
                              {
                                "columnId": "ProcessAverage",
                                "label": "Average"
                              },
                              {
                                "columnId": "ProcessP95th",
                                "label": "p95"
                              },
                              {
                                "columnId": "ProcessTrend",
                                "label": "Trend"
                              }
                            ]
                          },
                          "chartSettings": {
                            "showMetrics": false,
                            "showLegend": true
                          }
                        },
                        "customWidth": "40",
                        "name": "cpu usage - Copy - Copy",
                        "styleSettings": {
                          "margin": "5px",
                          "showBorder": true
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "WVDAgentHealthStatus\r\n| where _ResourceId =~ \"{HostPool}\"\r\n| where TimeGenerated > ago(24h)\r\n| extend HostPool=tostring(split(_ResourceId, \"/\")[8])\r\n| summarize arg_max(TimeGenerated, *) by SessionHostName//, bin(TimeGenerated, 1m)\r\n| project HostPool, SessionHostName\r\n| join kind=leftouter (\r\n    Perf\r\n    | where ObjectName == \"PhysicalDisk\"\r\n        and CounterName == \"Avg. Disk sec/Write\"\r\n        //and InstanceName == \"_Total\"\r\n        and InstanceName contains \"C:\"\r\n    | summarize Val=avg(CounterValue) by bin(TimeGenerated, 1m), Computer\r\n    | project TimeGenerated, Computer, Val\r\n    )\r\n    on $left.SessionHostName == $right.Computer\r\n| project TimeGenerated, Computer, Val\r\n\r\n",
                          "size": 1,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Disk sec/write (C:)",
                          "noDataMessage": "No performance counters to display. Please confirm that you have enabled the performance counter collection in your Log Analytics workspace",
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "visualization": "linechart",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Computer",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "22.8571ch"
                                }
                              },
                              {
                                "columnMatch": "ProcessAverage",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": ">=",
                                      "thresholdValue": "70",
                                      "representation": "2",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": ">=",
                                      "thresholdValue": "85",
                                      "representation": "4",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ],
                                  "customColumnWidthSetting": "12.8571ch"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": false,
                                    "minimumFractionDigits": 1,
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "ProcessP95th",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "10.7143ch"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "minimumFractionDigits": 1,
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "ProcessTrend",
                                "formatter": 9,
                                "formatOptions": {
                                  "min": 0,
                                  "max": 100,
                                  "palette": "greenRed",
                                  "customColumnWidthSetting": "210px"
                                }
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "Computer",
                                "label": "Host"
                              },
                              {
                                "columnId": "ProcessAverage",
                                "label": "Average"
                              },
                              {
                                "columnId": "ProcessP95th",
                                "label": "p95"
                              },
                              {
                                "columnId": "ProcessTrend",
                                "label": "Trend"
                              }
                            ]
                          },
                          "chartSettings": {
                            "showMetrics": false,
                            "showLegend": true
                          }
                        },
                        "customWidth": "40",
                        "name": "cpu usage - Copy - Copy - Copy",
                        "styleSettings": {
                          "margin": "5px",
                          "showBorder": true
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "WVDAgentHealthStatus\r\n| where _ResourceId =~ \"{HostPool}\"\r\n| where TimeGenerated > ago(24h)\r\n| extend HostPool=tostring(split(_ResourceId, \"/\")[8])\r\n| summarize arg_max(TimeGenerated, *) by SessionHostName//, bin(TimeGenerated, 1m)\r\n| project HostPool, SessionHostName\r\n| join kind=leftouter (\r\n    Perf\r\n    | where ObjectName == \"PhysicalDisk\"\r\n        and CounterName == \"Avg. Disk sec/Transfer\"\r\n        //and InstanceName == \"_Total\"\r\n        and InstanceName contains \"C:\"\r\n    | summarize Val=avg(CounterValue) by bin(TimeGenerated, 1m), Computer\r\n    | project TimeGenerated, Computer, Val\r\n    )\r\n    on $left.SessionHostName == $right.Computer\r\n| project TimeGenerated, Computer, Val\r\n\r\n",
                          "size": 1,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Disk sec/transfer (C:)",
                          "noDataMessage": "No performance counters to display. Please confirm that you have enabled the performance counter collection in your Log Analytics workspace",
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "visualization": "linechart",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Computer",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "22.8571ch"
                                }
                              },
                              {
                                "columnMatch": "ProcessAverage",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": ">=",
                                      "thresholdValue": "70",
                                      "representation": "2",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": ">=",
                                      "thresholdValue": "85",
                                      "representation": "4",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ],
                                  "customColumnWidthSetting": "12.8571ch"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": false,
                                    "minimumFractionDigits": 1,
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "ProcessP95th",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "10.7143ch"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "minimumFractionDigits": 1,
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "ProcessTrend",
                                "formatter": 9,
                                "formatOptions": {
                                  "min": 0,
                                  "max": 100,
                                  "palette": "greenRed",
                                  "customColumnWidthSetting": "210px"
                                }
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "Computer",
                                "label": "Host"
                              },
                              {
                                "columnId": "ProcessAverage",
                                "label": "Average"
                              },
                              {
                                "columnId": "ProcessP95th",
                                "label": "p95"
                              },
                              {
                                "columnId": "ProcessTrend",
                                "label": "Trend"
                              }
                            ]
                          },
                          "chartSettings": {
                            "showMetrics": false,
                            "showLegend": true
                          }
                        },
                        "customWidth": "40",
                        "name": "cpu usage - Copy - Copy - Copy - Copy",
                        "styleSettings": {
                          "margin": "5px",
                          "showBorder": true
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "WVDAgentHealthStatus\r\n| where _ResourceId =~ \"{HostPool}\"\r\n| where TimeGenerated > ago(24h)\r\n| extend HostPool=tostring(split(_ResourceId, \"/\")[8])\r\n| summarize arg_max(TimeGenerated, *) by SessionHostName//, bin(TimeGenerated, 1m)\r\n| project HostPool, SessionHostName\r\n| join kind=leftouter (\r\n    Perf\r\n| where ObjectName == \"User Input Delay per Process\" and CounterName == \"Max Input Delay\" and InstanceName !in (\"Max\", \"Average\") and CounterValue > 0\r\n    | summarize Value=percentile(CounterValue, 50) by bin(TimeGenerated, 15m), Computer,CounterName\r\n    | project TimeGenerated, Computer, Value\r\n    )\r\n    on $left.SessionHostName == $right.Computer\r\n| project TimeGenerated, Computer, Value\r\n//| render timechart with (ytitle=\" \", xtitle=\" \", ymax=100)\r\n\r\n",
                          "size": 1,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Median Input Delay",
                          "noDataMessage": "No performance counters to display. Please confirm that you have enabled the performance counter collection in your Log Analytics workspace",
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "visualization": "linechart",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Computer",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "22.8571ch"
                                }
                              },
                              {
                                "columnMatch": "ProcessAverage",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": ">=",
                                      "thresholdValue": "70",
                                      "representation": "2",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": ">=",
                                      "thresholdValue": "85",
                                      "representation": "4",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ],
                                  "customColumnWidthSetting": "12.8571ch"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": false,
                                    "minimumFractionDigits": 1,
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "ProcessP95th",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "10.7143ch"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "minimumFractionDigits": 1,
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "ProcessTrend",
                                "formatter": 9,
                                "formatOptions": {
                                  "min": 0,
                                  "max": 100,
                                  "palette": "greenRed",
                                  "customColumnWidthSetting": "210px"
                                }
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "Computer",
                                "label": "Host"
                              },
                              {
                                "columnId": "ProcessAverage",
                                "label": "Average"
                              },
                              {
                                "columnId": "ProcessP95th",
                                "label": "p95"
                              },
                              {
                                "columnId": "ProcessTrend",
                                "label": "Trend"
                              }
                            ]
                          },
                          "chartSettings": {
                            "showMetrics": false,
                            "showLegend": true,
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 23,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true
                                }
                              },
                              "min": 0
                            }
                          }
                        },
                        "customWidth": "40",
                        "name": "cpu usage - Copy - Copy - Copy - Copy",
                        "styleSettings": {
                          "margin": "5px",
                          "showBorder": true
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "WVDAgentHealthStatus\r\n| where _ResourceId =~ \"{HostPool}\"\r\n| where TimeGenerated > ago(24h)\r\n| extend HostPool=tostring(split(_ResourceId, \"/\")[8])\r\n| summarize arg_max(TimeGenerated, *) by SessionHostName//, bin(TimeGenerated, 1m)\r\n| project HostPool, SessionHostName\r\n| join kind=leftouter (\r\n    Perf\r\n| where ObjectName == \"RemoteFX Network\" and CounterName in (\"Current TCP RTT\")//, \"Current UDP RTT\")\r\n| where CounterValue > 0\r\n    | summarize Value=percentile(CounterValue, 50) by bin(TimeGenerated, 15m), Computer,CounterName\r\n    | project TimeGenerated, Computer, Value\r\n    )\r\n    on $left.SessionHostName == $right.Computer\r\n| project TimeGenerated, Computer, Value\r\n//| render timechart with (ytitle=\" \", xtitle=\" \", ymax=100)\r\n\r\n",
                          "size": 1,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Median Round Trip Time by Server",
                          "noDataMessage": "No performance counters to display. Please confirm that you have enabled the performance counter collection in your Log Analytics workspace",
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "visualization": "linechart",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Computer",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "22.8571ch"
                                }
                              },
                              {
                                "columnMatch": "ProcessAverage",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": ">=",
                                      "thresholdValue": "70",
                                      "representation": "2",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": ">=",
                                      "thresholdValue": "85",
                                      "representation": "4",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ],
                                  "customColumnWidthSetting": "12.8571ch"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": false,
                                    "minimumFractionDigits": 1,
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "ProcessP95th",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "10.7143ch"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "minimumFractionDigits": 1,
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "ProcessTrend",
                                "formatter": 9,
                                "formatOptions": {
                                  "min": 0,
                                  "max": 100,
                                  "palette": "greenRed",
                                  "customColumnWidthSetting": "210px"
                                }
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "Computer",
                                "label": "Host"
                              },
                              {
                                "columnId": "ProcessAverage",
                                "label": "Average"
                              },
                              {
                                "columnId": "ProcessP95th",
                                "label": "p95"
                              },
                              {
                                "columnId": "ProcessTrend",
                                "label": "Trend"
                              }
                            ]
                          },
                          "chartSettings": {
                            "showMetrics": false,
                            "showLegend": true,
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 23,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true
                                }
                              },
                              "min": 0
                            }
                          }
                        },
                        "customWidth": "40",
                        "name": "cpu usage - Copy - Copy - Copy - Copy - Copy",
                        "styleSettings": {
                          "margin": "5px",
                          "showBorder": true
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "WVDConnections\r\n| where _ResourceId =~ \"{HostPool}\"\r\n| distinct CorrelationId,GatewayRegion\r\n| join (WVDConnectionNetworkData) on CorrelationId\r\n| extend GatewayRegion = case(GatewayRegion == \"UGVI\",\"East\",GatewayRegion == \"UGAZ\", \"West\",GatewayRegion)\r\n| summarize RTT=percentile(EstRoundTripTimeInMs,50) by bin(TimeGenerated,15m),GatewayRegion,_ResourceId",
                          "size": 1,
                          "aggregation": 5,
                          "showAnalytics": true,
                          "title": "Median Round Trip Time by Region",
                          "noDataMessage": "No performance counters to display. Please confirm that you have enabled the performance counter collection in your Log Analytics workspace",
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "visualization": "linechart",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Computer",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "22.8571ch"
                                }
                              },
                              {
                                "columnMatch": "ProcessAverage",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": ">=",
                                      "thresholdValue": "70",
                                      "representation": "2",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": ">=",
                                      "thresholdValue": "85",
                                      "representation": "4",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ],
                                  "customColumnWidthSetting": "12.8571ch"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": false,
                                    "minimumFractionDigits": 1,
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "ProcessP95th",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "10.7143ch"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "minimumFractionDigits": 1,
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "ProcessTrend",
                                "formatter": 9,
                                "formatOptions": {
                                  "min": 0,
                                  "max": 100,
                                  "palette": "greenRed",
                                  "customColumnWidthSetting": "210px"
                                }
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "Computer",
                                "label": "Host"
                              },
                              {
                                "columnId": "ProcessAverage",
                                "label": "Average"
                              },
                              {
                                "columnId": "ProcessP95th",
                                "label": "p95"
                              },
                              {
                                "columnId": "ProcessTrend",
                                "label": "Trend"
                              }
                            ]
                          },
                          "chartSettings": {
                            "showMetrics": false,
                            "showLegend": true,
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 23,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true
                                }
                              },
                              "min": 0
                            }
                          }
                        },
                        "customWidth": "40",
                        "name": "cpu usage - Copy - Copy - Copy - Copy - Copy - Copy",
                        "styleSettings": {
                          "margin": "5px",
                          "showBorder": true
                        }
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "PerfTab",
                    "comparison": "isEqualTo",
                    "value": "PerformanceOverview"
                  },
                  "name": "General Perf Group"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "parameters": [
                            {
                              "id": "affd9b12-b995-4ad1-a670-12c5eff45a23",
                              "version": "KqlParameterItem/1.0",
                              "name": "VirtualMachine",
                              "label": "Virtual Machine",
                              "type": 5,
                              "multiSelect": true,
                              "quote": "'",
                              "delimiter": ",",
                              "query": "Heartbeat\r\n| distinct Computer,_ResourceId\r\n| extend Computer = toupper(Computer)\r\n| join (\r\nWVDAgentHealthStatus\r\n| where _ResourceId =~ \"{HostPool}\"\r\n| where TimeGenerated > ago(24h)\r\n//| extend HostPool=tostring(split(_ResourceId, \"/\")[8])\r\n| summarize arg_max(TimeGenerated, *) by SessionHostName//, bin(TimeGenerated, 1m)\r\n| project Computer = toupper(SessionHostName)\r\n) on Computer\r\n| project _ResourceId",
                              "crossComponentResources": [
                                "{poolla}"
                              ],
                              "typeSettings": {
                                "resourceTypeFilter": {
                                  "microsoft.compute/virtualmachines": true,
                                  "microsoft.all/virtualmachines": true,
                                  "microsoft.devtestlab/labs/virtualmachines": true,
                                  "microsoft.classiccompute/virtualmachines": true
                                },
                                "additionalResourceOptions": [
                                  "value::all"
                                ],
                                "showDefault": false
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "parameters - 1"
                      },
                      {
                        "type": 10,
                        "content": {
                          "chartId": "workbookea2ab6f1-9a9a-45e8-9950-03e42b056ed0",
                          "version": "MetricsItem/2.0",
                          "size": 0,
                          "chartType": 2,
                          "resourceType": "microsoft.compute/virtualmachines",
                          "metricScope": 0,
                          "resourceParameter": "VirtualMachine",
                          "resourceIds": [
                            "{VirtualMachine}"
                          ],
                          "timeContextFromParameter": "TimeRange",
                          "timeContext": {
                            "durationMs": 172800000
                          },
                          "metrics": [
                            {
                              "namespace": "microsoft.compute/virtualmachines",
                              "metric": "microsoft.compute/virtualmachines--OS Disk IOPS Consumed Percentage",
                              "aggregation": 3,
                              "splitBy": null,
                              "columnName": "OS Disk IOPS Consumed % (Max)"
                            }
                          ],
                          "title": "OS Disk IOPS Consumed % (Max)",
                          "gridSettings": {
                            "rowLimit": 10000
                          }
                        },
                        "customWidth": "50",
                        "name": "OS Disk IOPS Consumed % (Max)"
                      },
                      {
                        "type": 10,
                        "content": {
                          "chartId": "workbookea2ab6f1-9a9a-45e8-9950-03e42b056ed0",
                          "version": "MetricsItem/2.0",
                          "size": 0,
                          "chartType": 2,
                          "resourceType": "microsoft.compute/virtualmachines",
                          "metricScope": 0,
                          "resourceParameter": "VirtualMachine",
                          "resourceIds": [
                            "{VirtualMachine}"
                          ],
                          "timeContextFromParameter": "TimeRange",
                          "timeContext": {
                            "durationMs": 172800000
                          },
                          "metrics": [
                            {
                              "namespace": "microsoft.compute/virtualmachines",
                              "metric": "microsoft.compute/virtualmachines--OS Disk Bandwidth Consumed Percentage",
                              "aggregation": 3,
                              "splitBy": null,
                              "columnName": "OS Disk Bandwidth Consumed % (Max)"
                            }
                          ],
                          "title": "OS Disk Bandwidth Consumed % (Max)",
                          "gridSettings": {
                            "rowLimit": 10000
                          }
                        },
                        "customWidth": "50",
                        "name": "OS Disk IOPS Consumed % (Max) - Copy"
                      },
                      {
                        "type": 10,
                        "content": {
                          "chartId": "workbookea2ab6f1-9a9a-45e8-9950-03e42b056ed0",
                          "version": "MetricsItem/2.0",
                          "size": 0,
                          "chartType": 2,
                          "resourceType": "microsoft.compute/virtualmachines",
                          "metricScope": 0,
                          "resourceParameter": "VirtualMachine",
                          "resourceIds": [
                            "{VirtualMachine}"
                          ],
                          "timeContextFromParameter": "TimeRange",
                          "timeContext": {
                            "durationMs": 172800000
                          },
                          "metrics": [
                            {
                              "namespace": "microsoft.compute/virtualmachines",
                              "metric": "microsoft.compute/virtualmachines--OS Disk Read Operations/Sec",
                              "aggregation": 3,
                              "splitBy": null
                            }
                          ],
                          "title": "OS Disk Read Operations/sec",
                          "gridSettings": {
                            "rowLimit": 10000
                          }
                        },
                        "customWidth": "50",
                        "name": "OS Disk Read Operations/sec"
                      },
                      {
                        "type": 10,
                        "content": {
                          "chartId": "workbookea2ab6f1-9a9a-45e8-9950-03e42b056ed0",
                          "version": "MetricsItem/2.0",
                          "size": 0,
                          "chartType": 2,
                          "resourceType": "microsoft.compute/virtualmachines",
                          "metricScope": 0,
                          "resourceParameter": "VirtualMachine",
                          "resourceIds": [
                            "{VirtualMachine}"
                          ],
                          "timeContextFromParameter": "TimeRange",
                          "timeContext": {
                            "durationMs": 172800000
                          },
                          "metrics": [
                            {
                              "namespace": "microsoft.compute/virtualmachines",
                              "metric": "microsoft.compute/virtualmachines--OS Disk Write Operations/Sec",
                              "aggregation": 3,
                              "splitBy": null
                            }
                          ],
                          "title": "OS Disk Write Operations/sec",
                          "gridSettings": {
                            "rowLimit": 10000
                          }
                        },
                        "customWidth": "50",
                        "name": "OS Disk Write Operations/sec - Copy"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "PerfTab",
                    "comparison": "isEqualTo",
                    "value": "DiskMetrics"
                  },
                  "name": "Disk Metrics Group"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "e417eb51-c40c-4eff-bff1-75a34859403c",
                              "version": "KqlParameterItem/1.0",
                              "name": "Computer",
                              "type": 2,
                              "isRequired": true,
                              "query": "    Perf\r\n    | where ObjectName == \"PhysicalDisk\"\r\n        and CounterName == \"Avg. Disk sec/Read\"\r\n    | distinct Computer",
                              "crossComponentResources": [
                                "{poolla}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces",
                              "value": null
                            },
                            {
                              "id": "f56ab166-d8b0-4eef-86f9-a48b7889cee7",
                              "version": "KqlParameterItem/1.0",
                              "name": "Instance",
                              "type": 2,
                              "isRequired": true,
                              "query": "    Perf\r\n    | where ObjectName == \"PhysicalDisk\"\r\n        and Computer == \"{Computer}\"\r\n    | distinct InstanceName",
                              "crossComponentResources": [
                                "{poolla}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces",
                              "value": null
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "parameters - 2"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "WVDAgentHealthStatus\r\n| where _ResourceId =~ \"{HostPool}\"\r\n| where TimeGenerated > ago(24h)\r\n| extend HostPool=tostring(split(_ResourceId, \"/\")[8])\r\n| summarize arg_max(TimeGenerated, *) by SessionHostName//, bin(TimeGenerated, 1m)\r\n| project HostPool, SessionHostName\r\n| join kind=leftouter (\r\n    Perf\r\n    | where ObjectName == \"PhysicalDisk\"\r\n        and CounterName == \"Avg. Disk sec/Read\"\r\n        //and InstanceName == \"_Total\"\r\n        //and InstanceName contains \"C:\"\r\n        and InstanceName == \"{Instance}\"\r\n        and Computer == \"{Computer}\"\r\n    | summarize Min=min(CounterValue), Max=max(CounterValue), Avg=avg(CounterValue), StDev=stdev(CounterValue) by bin(TimeGenerated, 10m), Computer\r\n    | project TimeGenerated, Computer, Min,Max,Avg,StDev\r\n    )\r\n    on $left.SessionHostName == $right.Computer\r\n| project TimeGenerated, Computer, Min,Max,Avg,StDev\r\n",
                          "size": 0,
                          "title": "Avg. Disk sec/Read",
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "visualization": "linechart",
                          "chartSettings": {
                            "showMetrics": false,
                            "showLegend": true
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 0"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "WVDAgentHealthStatus\r\n| where _ResourceId =~ \"{HostPool}\"\r\n| where TimeGenerated > ago(24h)\r\n| extend HostPool=tostring(split(_ResourceId, \"/\")[8])\r\n| summarize arg_max(TimeGenerated, *) by SessionHostName//, bin(TimeGenerated, 1m)\r\n| project HostPool, SessionHostName\r\n| join kind=leftouter (\r\n    Perf\r\n    | where ObjectName == \"PhysicalDisk\"\r\n        and CounterName == \"Avg. Disk sec/Write\"\r\n        //and InstanceName == \"_Total\"\r\n        //and InstanceName contains \"C:\"\r\n        and InstanceName == \"{Instance}\"\r\n        and Computer == \"{Computer}\"\r\n    | summarize Min=min(CounterValue), Max=max(CounterValue), Avg=avg(CounterValue), StDev=stdev(CounterValue) by bin(TimeGenerated, 10m), Computer\r\n    | project TimeGenerated, Computer, Min,Max,Avg,StDev\r\n    )\r\n    on $left.SessionHostName == $right.Computer\r\n| project TimeGenerated, Computer, Min,Max,Avg,StDev\r\n",
                          "size": 0,
                          "title": "Avg. Disk sec/Write",
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "visualization": "linechart",
                          "chartSettings": {
                            "showMetrics": false,
                            "showLegend": true
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 0 - Copy"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "WVDAgentHealthStatus\r\n| where _ResourceId =~ \"{HostPool}\"\r\n| where TimeGenerated > ago(24h)\r\n| extend HostPool=tostring(split(_ResourceId, \"/\")[8])\r\n| summarize arg_max(TimeGenerated, *) by SessionHostName//, bin(TimeGenerated, 1m)\r\n| project HostPool, SessionHostName\r\n| join kind=leftouter (\r\n    Perf\r\n    | where ObjectName == \"PhysicalDisk\"\r\n        and CounterName == \"Avg. Disk sec/Transfer\"\r\n        //and InstanceName == \"_Total\"\r\n        //and InstanceName contains \"C:\"\r\n        and InstanceName == \"{Instance}\"\r\n        and Computer == \"{Computer}\"\r\n    | summarize Min=min(CounterValue), Max=max(CounterValue), Avg=avg(CounterValue), StDev=stdev(CounterValue) by bin(TimeGenerated, 10m), Computer\r\n    | project TimeGenerated, Computer, Min,Max,Avg,StDev\r\n    )\r\n    on $left.SessionHostName == $right.Computer\r\n| project TimeGenerated, Computer, Min,Max,Avg,StDev\r\n",
                          "size": 0,
                          "title": "Avg. Disk sec/Transfer",
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "visualization": "linechart",
                          "chartSettings": {
                            "showMetrics": false,
                            "showLegend": true
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 0 - Copy - Copy"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "WVDAgentHealthStatus\r\n| where _ResourceId =~ \"{HostPool}\"\r\n| where TimeGenerated > ago(24h)\r\n| extend HostPool=tostring(split(_ResourceId, \"/\")[8])\r\n| summarize arg_max(TimeGenerated, *) by SessionHostName//, bin(TimeGenerated, 1m)\r\n| project HostPool, SessionHostName\r\n| join kind=leftouter (\r\n    Perf\r\n    | where ObjectName == \"PhysicalDisk\"\r\n        and CounterName == \"Avg. Disk Queue Length\"\r\n        //and InstanceName == \"_Total\"\r\n        //and InstanceName contains \"C:\"\r\n        and InstanceName == \"{Instance}\"\r\n        and Computer == \"{Computer}\"\r\n    | summarize Min=min(CounterValue), Max=max(CounterValue), Avg=avg(CounterValue), StDev=stdev(CounterValue) by bin(TimeGenerated, 10m), Computer\r\n    | project TimeGenerated, Computer, Min,Max,Avg,StDev\r\n    )\r\n    on $left.SessionHostName == $right.Computer\r\n| project TimeGenerated, Computer, Min,Max,Avg,StDev\r\n",
                          "size": 0,
                          "title": "Avg. Disk Queue Length",
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "visualization": "linechart",
                          "chartSettings": {
                            "showMetrics": false,
                            "showLegend": true
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 0 - Copy - Copy - Copy"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "PerfTab",
                    "comparison": "isEqualTo",
                    "value": "DiskPerformance"
                  },
                  "name": "Disk Perf Group"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "performance"
            },
            "name": "Performance Group"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "d35a2c77-92d5-4632-98ed-2bae6f8ca3f6",
                        "version": "KqlParameterItem/1.0",
                        "name": "TimeRange",
                        "type": 4,
                        "typeSettings": {
                          "selectableValues": [
                            {
                              "durationMs": 86400000
                            },
                            {
                              "durationMs": 172800000
                            },
                            {
                              "durationMs": 259200000
                            },
                            {
                              "durationMs": 604800000
                            },
                            {
                              "durationMs": 1209600000
                            },
                            {
                              "durationMs": 2592000000
                            }
                          ],
                          "allowCustom": true
                        },
                        "timeContextFromParameter": "TimeRange",
                        "value": {
                          "durationMs": 2592000000
                        }
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "name": "parameters_timerange - Copy"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "WVDConnections\r\n| where State == \"Connected\"\r\n| where TimeGenerated {TimeRange}\r\n| where _ResourceId =~ '{HostPool}'\r\n| summarize Users=dcount(UserName)\r\n| evaluate narrow()\r\n| project-away Row\r\n| extend Column = strcat(\"Unique \",Column)",
                          "size": 3,
                          "title": "Unique Users",
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {},
                            "subtitleContent": {
                              "columnMatch": "Value",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto",
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": []
                                }
                              }
                            },
                            "showBorder": false
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 8",
                        "styleSettings": {
                          "showBorder": true
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "WVDConnections \r\n| where State == \"Connected\"  \r\n| where TimeGenerated {TimeRange}\r\n| where _ResourceId =~ '{HostPool}'\r\n| project CorrelationId , UserName, ConnectionType , StartTime=TimeGenerated,_ResourceId \r\n| project-rename Hostpool = _ResourceId \r\n| extend HostPool=toupper(strcat(split(Hostpool,\"/\")[4],\".\",split(Hostpool,\"/\")[8]))\r\n| join (WVDConnections  \r\n    | where State == \"Completed\"  \r\n    | project EndTime=TimeGenerated, CorrelationId)  \r\n    on CorrelationId  \r\n| project UserName,HostPool,ConnectionType,Duration = EndTime - StartTime,StartTime,EndTime\r\n| sort by Duration desc\r\n| extend weekday=dayofweek(StartTime)\r\n| where weekday != 0d and weekday !=6d\r\n|summarize usageperday=sum(Duration) by bin(StartTime,1d),UserName\r\n| summarize AvgUserHoursPerDay=avg(usageperday/1h) by StartTime //UsersPerDay=dcount(UserName)\r\n| where StartTime > ago(30d) and StartTime <ago(1d)\r\n| sort by StartTime asc\r\n| summarize AvgUserHoursPerDay=round(avg(AvgUserHoursPerDay),1)\r\n| evaluate narrow()\r\n| project-away Row\r\n",
                          "size": 3,
                          "title": "Average User Hours Per Day",
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {},
                            "subtitleContent": {
                              "columnMatch": "Value",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto",
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": []
                                }
                              }
                            },
                            "showBorder": false
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 8 - Copy - Copy - Copy",
                        "styleSettings": {
                          "showBorder": true
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let data=\r\nWVDAgentHealthStatus \r\n| extend HostPool=tostring(split(_ResourceId,\"/\")[8] )\r\n| where TimeGenerated {TimeRange}\r\n| where _ResourceId =~ '{HostPool}'\r\n| summarize arg_max(TimeGenerated,*) by SessionHostName, bin(TimeGenerated,5m)\r\n| summarize Sessions = sum(toint(ActiveSessions)) + sum(toint(InactiveSessions)) by TimeGenerated;\r\nlet dps=ceiling(toscalar(data|count)/5000.0);\r\ndata|summarize Sessions=max(Sessions) by bin(TimeGenerated,1d)\r\n| extend weekday=dayofweek(TimeGenerated)\r\n| where weekday != 0d and weekday !=6d\r\n| summarize AvgMaxSessions=round(avg(Sessions))\r\n| evaluate narrow()\r\n| project-away Row",
                          "size": 3,
                          "title": "Average Max Daily Sessions",
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {},
                            "subtitleContent": {
                              "columnMatch": "Value",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto",
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": []
                                }
                              }
                            },
                            "showBorder": false
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 8 - Copy",
                        "styleSettings": {
                          "showBorder": true
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "WVDConnections\r\n| where State == \"Connected\"\r\n| where TimeGenerated {TimeRange}\r\n| where _ResourceId =~ '{HostPool}'\r\n| extend weekday=dayofweek(TimeGenerated)\r\n| where weekday != 0d and weekday !=6d\r\n| summarize Count=dcount(UserName) by bin(TimeGenerated,1d)\r\n| summarize AvgUsersPerDay=round(avg(Count))\r\n| evaluate narrow()\r\n| project-away Row",
                          "size": 3,
                          "title": "Average Users Per Day",
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {},
                            "subtitleContent": {
                              "columnMatch": "Value",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto",
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": []
                                }
                              }
                            },
                            "showBorder": false
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 8 - Copy - Copy",
                        "styleSettings": {
                          "showBorder": true
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "WVDConnections\r\n| where _ResourceId =~ '{HostPool}'\r\n|distinct CorrelationId,ClientType\r\n|project ClientShort=replace(\"com.microsoft.rdc.\", \"\", ClientType)\r\n| summarize Count=count() by ClientShort\r\n| order by Count desc",
                          "size": 1,
                          "title": "Clients (by connection count)",
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "visualization": "piechart",
                          "chartSettings": {
                            "showMetrics": false,
                            "showLegend": true
                          }
                        },
                        "name": "query - 7 - Copy",
                        "styleSettings": {
                          "showBorder": true
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "//profile size\r\nEvent\r\n| where TimeGenerated>ago(360d)\r\n| where EventLog == 'Microsoft-FSLogix-Apps/Operational' and EventID == 57\r\n| parse kind=relaxed EventData with *\r\n    \"<Data Name=\\\"Path\\\">\" Path\r\n    \"</Data><Data Name=\\\"WasCompacted\\\">\" DiskCompaction\r\n    \"</Data><Data Name=\\\"MaxSupportedSizeMB\\\">\" MaxSupportedSizeMB\r\n    \"</Data><Data Name=\\\"MinSupportedSizeMB\\\">\" MinSupportedSizeMB\r\n    \"</Data><Data Name=\\\"SizeBeforeMB\\\">\" SizeBeforeMB\r\n    \"</Data><Data Name=\\\"SizeAfterMB\\\">\" SizeAfterMB\r\n    \"</Data><Data Name=\\\"SavedSpaceMB\\\">\" SavedSpaceMB\r\n    \"</Data><Data Name=\\\"TimeSpentMillis\\\">\" TimeSpentMillis \"</Data>\" *\r\n| extend TimeSpent = todecimal(TimeSpentMillis) / 1024\r\n| where DiskCompaction <> \"\"\r\n| extend [\"VHD Max Size\"]=todouble(MaxSupportedSizeMB)\r\n| extend [\"VHD Size On Disk\"]=todouble(SizeAfterMB)\r\n| summarize arg_max(TimeGenerated,*) by Path\r\n| extend idx1=indexof(Path,\"Profile_\")\r\n| extend uname=substring(Path,idx1+8)\r\n| extend uname=toupper(uname)\r\n| extend uname=trim_end(\".VHDX\",uname)\r\n| project TimeGenerated,uname,Path,[\"VHD Max Size\"],[\"VHD Size On Disk\"],Usage=100*([\"VHD Size On Disk\"])/[\"VHD Max Size\"]\r\n| project-away Path\r\n| join \r\n(\r\nWVDCheckpoints\r\n| where TimeGenerated>ago(360d)\r\n| where Name == \"ProfileLoggedOn\"\r\n| summarize arg_max(TimeGenerated,*) by UserName\r\n| extend uname= tostring(Parameters.Username)\r\n| extend uname= trim_start(\"\",uname)\r\n| extend uname=trim_end(\"\",uname)\r\n| project UserName,uname,_ResourceId\r\n) on uname\r\n| where _ResourceId =~ '{HostPool}'\r\n| project TimeGenerated,UserName,[\"VHD Max Size\"],[\"VHD Size On Disk\"],Usage\r\n| order by Usage desc\r\n| extend ProfileSize = case([\"VHD Size On Disk\"]>15000,\"Over 15gb\",[\"VHD Size On Disk\"] between (5000 .. 15000),\"5gb - 15gb\", [\"VHD Size On Disk\"] <5000,\"Less Than 5gb\",\"Other\")\r\n| summarize Count=count() by ProfileSize\r\n\r\n",
                          "size": 1,
                          "title": "Profile Size",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "visualization": "piechart"
                        },
                        "name": "query - 3",
                        "styleSettings": {
                          "showBorder": true
                        }
                      }
                    ]
                  },
                  "customWidth": "33",
                  "name": "Users_Client Group"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let data=\r\nWVDAgentHealthStatus \r\n| extend HostPool=tostring(split(_ResourceId,\"/\")[8] )\r\n| where TimeGenerated {TimeRange}\r\n| where _ResourceId =~ '{HostPool}'\r\n| summarize arg_max(TimeGenerated,*) by SessionHostName, bin(TimeGenerated,5m)\r\n| summarize Sessions = sum(toint(ActiveSessions)) + sum(toint(InactiveSessions)), ActiveSessions = sum(toint(ActiveSessions)) by TimeGenerated;\r\nlet dps=ceiling(toscalar(data|count)/5000.0);\r\ndata|summarize Sessions=max(Sessions) by bin(TimeGenerated,1d)\r\n| extend weekday=dayofweek(TimeGenerated)\r\n| where weekday != 0d and weekday !=6d\r\n",
                          "size": 1,
                          "aggregation": 3,
                          "title": "Max Sessions per Day (Mon-Fri)",
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "visualization": "linechart",
                          "chartSettings": {
                            "showMetrics": false
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 4",
                        "styleSettings": {
                          "showBorder": true
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let data=\r\nWVDAgentHealthStatus \r\n| extend HostPool=tostring(split(_ResourceId,\"/\")[8] )\r\n| where TimeGenerated {TimeRange}\r\n| where _ResourceId =~ '{HostPool}'\r\n| summarize arg_max(TimeGenerated,*) by SessionHostName, bin(TimeGenerated,5m)\r\n| summarize Sessions = sum(toint(ActiveSessions)) + sum(toint(InactiveSessions)), ActiveSessions = sum(toint(ActiveSessions)) by TimeGenerated;\r\nlet dps=ceiling(toscalar(data|count)/5000.0);\r\ndata|summarize Sessions=max(ActiveSessions) by bin(TimeGenerated,1d)\r\n| extend weekday=dayofweek(TimeGenerated)\r\n| where weekday != 0d and weekday !=6d\r\n",
                          "size": 1,
                          "aggregation": 3,
                          "title": "Max Active Sessions per Day (Mon-Fri)",
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "visualization": "linechart",
                          "chartSettings": {
                            "showMetrics": false
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 4 - Copy",
                        "styleSettings": {
                          "showBorder": true
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "WVDConnections \r\n| where State == \"Connected\"  \r\n| where TimeGenerated {TimeRange}\r\n| where _ResourceId =~ '{HostPool}'\r\n| project CorrelationId , UserName, ConnectionType , StartTime=TimeGenerated,_ResourceId \r\n| project-rename Hostpool = _ResourceId \r\n| extend HostPool=toupper(strcat(split(Hostpool,\"/\")[4],\".\",split(Hostpool,\"/\")[8]))\r\n| join (WVDConnections  \r\n    | where State == \"Completed\"  \r\n    | project EndTime=TimeGenerated, CorrelationId)  \r\n    on CorrelationId  \r\n| project UserName,HostPool,ConnectionType,Duration = EndTime - StartTime,StartTime,EndTime\r\n| sort by Duration desc\r\n| extend weekday=dayofweek(StartTime)\r\n| where weekday != 0d and weekday !=6d\r\n|summarize usageperday=sum(Duration) by bin(StartTime,1d),UserName\r\n| summarize AvgUserHoursPerDay=avg(usageperday/1h) by StartTime //UsersPerDay=dcount(UserName)\r\n| where StartTime > ago(30d) and StartTime <ago(1d)\r\n| sort by StartTime asc\r\n| render timechart with (ytitle=\" \", xtitle=\" \",legend=hidden)\r\n",
                          "size": 1,
                          "aggregation": 3,
                          "title": "Avg User Hours (Mon-Fri)",
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "visualization": "linechart",
                          "chartSettings": {
                            "showMetrics": false
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 4",
                        "styleSettings": {
                          "showBorder": true
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "WVDConnections\r\n| where State == \"Connected\"\r\n| where TimeGenerated {TimeRange}\r\n| where _ResourceId =~ '{HostPool}'\r\n| extend weekday=dayofweek(TimeGenerated)\r\n| where weekday != 0d and weekday !=6d\r\n| summarize Count=dcount(UserName) by bin(TimeGenerated,1d)",
                          "size": 1,
                          "aggregation": 3,
                          "title": "Users per Day (Mon-Fri)",
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "visualization": "linechart",
                          "chartSettings": {
                            "showMetrics": false
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 0",
                        "styleSettings": {
                          "showBorder": true
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "//profile size\r\nEvent\r\n| where TimeGenerated>ago(360d)\r\n| where EventLog == 'Microsoft-FSLogix-Apps/Operational' and EventID == 57\r\n| parse kind=relaxed EventData with *\r\n    \"<Data Name=\\\"Path\\\">\" Path\r\n    \"</Data><Data Name=\\\"WasCompacted\\\">\" DiskCompaction\r\n    \"</Data><Data Name=\\\"MaxSupportedSizeMB\\\">\" MaxSupportedSizeMB\r\n    \"</Data><Data Name=\\\"MinSupportedSizeMB\\\">\" MinSupportedSizeMB\r\n    \"</Data><Data Name=\\\"SizeBeforeMB\\\">\" SizeBeforeMB\r\n    \"</Data><Data Name=\\\"SizeAfterMB\\\">\" SizeAfterMB\r\n    \"</Data><Data Name=\\\"SavedSpaceMB\\\">\" SavedSpaceMB\r\n    \"</Data><Data Name=\\\"TimeSpentMillis\\\">\" TimeSpentMillis \"</Data>\" *\r\n| extend TimeSpent = todecimal(TimeSpentMillis) / 1024\r\n| where DiskCompaction <> \"\"\r\n| extend [\"VHD Max Size\"]=todouble(MaxSupportedSizeMB)\r\n| extend [\"VHD Size On Disk\"]=todouble(SizeAfterMB)\r\n| summarize arg_max(TimeGenerated,*) by Path\r\n| extend idx1=indexof(Path,\"Profile_\")\r\n| extend uname=substring(Path,idx1+8)\r\n| extend uname=toupper(uname)\r\n| extend uname=trim_end(\".VHDX\",uname)\r\n| project TimeGenerated,uname,Path,[\"VHD Max Size\"],[\"VHD Size On Disk\"],Usage=100*([\"VHD Size On Disk\"])/[\"VHD Max Size\"]\r\n| project-away Path\r\n| join \r\n(\r\nWVDCheckpoints\r\n| where TimeGenerated>ago(360d)\r\n| where Name == \"ProfileLoggedOn\"\r\n| summarize arg_max(TimeGenerated,*) by UserName\r\n| extend uname= tostring(Parameters.Username)\r\n| extend uname= trim_start(\"\",uname)\r\n| extend uname=trim_end(\"\",uname)\r\n| project UserName,uname,_ResourceId\r\n) on uname\r\n| where _ResourceId =~ '{HostPool}'\r\n| project TimeGenerated,UserName,[\"VHD Max Size\"],[\"VHD Size On Disk\"],Usage\r\n| order by Usage desc\r\n\r\n\r\n",
                          "size": 1,
                          "title": "Profile Size",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "TimeGenerated",
                                "formatter": 6,
                                "formatOptions": {
                                  "customColumnWidthSetting": "15.2857ch"
                                },
                                "dateFormat": {
                                  "formatName": "shortDatePattern"
                                }
                              },
                              {
                                "columnMatch": "UserName",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "32.1429ch"
                                }
                              },
                              {
                                "columnMatch": "VHD Max Size",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "VHD Size On Disk",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 0,
                                  "max": 30000,
                                  "palette": "greenRed",
                                  "customColumnWidthSetting": "104px"
                                },
                                "numberFormat": {
                                  "unit": 4,
                                  "options": {
                                    "style": "decimal",
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "Usage",
                                "formatter": 5,
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "maximumFractionDigits": 0
                                  }
                                }
                              }
                            ],
                            "rowLimit": 1000,
                            "labelSettings": [
                              {
                                "columnId": "TimeGenerated",
                                "label": "Last Logoff"
                              },
                              {
                                "columnId": "UserName",
                                "label": "User Name"
                              },
                              {
                                "columnId": "VHD Max Size",
                                "label": "VHD Max Size"
                              },
                              {
                                "columnId": "VHD Size On Disk",
                                "label": "VHD Size"
                              }
                            ]
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 3 - Copy",
                        "styleSettings": {
                          "showBorder": true
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "WVDErrors \r\n| where TimeGenerated {TimeRange}\r\n| where _ResourceId =~ '{HostPool}'\r\n| summarize ErrorCount=count() by bin(TimeGenerated,1d)\r\n//| project [\"Error Message\"]=CodeSymbolic,[\"Error Count\"]=ErrorCount,[\"User Count\"]=UserCount,TimeGenerated\r\n| project TimeGenerated,[\"Error Count\"]=ErrorCount",
                          "size": 1,
                          "aggregation": 3,
                          "title": "Connection Errors",
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "visualization": "linechart",
                          "chartSettings": {
                            "showMetrics": false
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 0 - Copy",
                        "styleSettings": {
                          "showBorder": true
                        }
                      }
                    ]
                  },
                  "customWidth": "66",
                  "name": "usage charts group"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "usage"
            },
            "name": "Usage Group",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "name": "Health"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "tabs",
              "links": [
                {
                  "id": "a58c3ea1-76a0-46aa-bd18-14d3084875b6",
                  "cellValue": "selectedTab",
                  "linkTarget": "parameter",
                  "linkLabel": "Overview",
                  "subTarget": "Overview",
                  "style": "link"
                },
                {
                  "id": "eac77638-e60c-458f-8f06-b5e8046c7330",
                  "cellValue": "selectedTab",
                  "linkTarget": "parameter",
                  "linkLabel": "Details",
                  "subTarget": "Details",
                  "style": "link"
                }
              ]
            },
            "name": "links - 10"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "title": "Monitoring Configuration",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{SubscriptionPicked}"
                          ],
                          "parameters": [
                            {
                              "id": "40f5c83d-1a82-4186-83f9-934e125bef19",
                              "version": "KqlParameterItem/1.0",
                              "name": "PolicyAssignments",
                              "label": "Policy Assignments",
                              "type": 2,
                              "isRequired": true,
                              "multiSelect": true,
                              "quote": "'",
                              "delimiter": ",",
                              "query": "policyresources\r\n| where type == \"microsoft.authorization/policyassignments\"\r\n| extend DisplayName = tostring(properties.displayName)\r\n| extend policyDefinitionId = tostring(properties.policyDefinitionId)\r\n| project name,DisplayName,policyDefinitionId\r\n| join kind=leftouter (\r\npolicyresources\r\n| where type in (\"microsoft.authorization/policydefinitions\",\"microsoft.authorization/policysetdefinitions\")\r\n| extend PolicyDefinitionName = tostring(properties.displayName)\r\n| extend name = tostring(name)\r\n| extend Category = properties.metadata.category\r\n| project PolicyDefinitionName,Category,name,id\r\n) on $left.policyDefinitionId == $right.id\r\n| where Category == \"Monitoring\"\r\n| project name,DisplayName\r\n| order by DisplayName asc",
                              "crossComponentResources": [
                                "{SubscriptionPicked}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::all"
                                ],
                                "showDefault": false
                              },
                              "defaultValue": "value::all",
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources"
                            }
                          ],
                          "style": "pills",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources"
                        },
                        "name": "parameters - 3 - Copy - Copy"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "policyresources\r\n| where type =~ 'Microsoft.PolicyInsights/PolicyStates'\r\n| extend complianceState = tostring(properties.complianceState)\r\n| extend\r\n\tresourceId = tostring(properties.resourceId),\r\n\tpolicyAssignmentId = tostring(properties.policyAssignmentId),\r\n\tpolicyAssignmentScope = tostring(properties.policyAssignmentScope),\r\n\tpolicyAssignmentName = tostring(properties.policyAssignmentName),\r\n\tpolicyDefinitionId = tostring(properties.policyDefinitionId),\r\n\tpolicyDefinitionReferenceId = tostring(properties.policyDefinitionReferenceId),\r\n\tstateWeight = iff(complianceState == 'NonCompliant', int(300), iff(complianceState == 'Compliant', int(200), iff(complianceState == 'Conflict', int(100), iff(complianceState == 'Exempt', int(50), int(0)))))\r\n| summarize max(stateWeight) by resourceId, policyAssignmentId, policyAssignmentScope, policyAssignmentName\r\n| summarize counts = count() by policyAssignmentId, policyAssignmentScope, max_stateWeight, policyAssignmentName\r\n| summarize overallStateWeight = max(max_stateWeight),\r\nnonCompliantCount = sumif(counts, max_stateWeight == 300),\r\ncompliantCount = sumif(counts, max_stateWeight == 200),\r\nconflictCount = sumif(counts, max_stateWeight == 100),\r\nexemptCount = sumif(counts, max_stateWeight == 50) by policyAssignmentId, policyAssignmentScope, policyAssignmentName\r\n| extend totalResources = todouble(nonCompliantCount + compliantCount + conflictCount + exemptCount)\r\n| extend compliancePercentage = iff(totalResources == 0, todouble(100), 100 * todouble(compliantCount + exemptCount) / totalResources)\r\n| project \r\ncomplianceState = iff(overallStateWeight == 300, 'noncompliant', iff(overallStateWeight == 200, 'compliant', iff(overallStateWeight == 100, 'conflict', iff(overallStateWeight == 50, 'exempt', 'notstarted')))),\r\npolicyAssignmentName, scope = policyAssignmentScope,\r\ncompliancePercentage,\r\ncompliantCount,\r\nnonCompliantCount,\r\nconflictCount,\r\nexemptCount\r\n| where policyAssignmentName in ({PolicyAssignments})\r\n| join kind=leftouter (\r\npolicyresources\r\n| where type == \"microsoft.authorization/policyassignments\"\r\n| extend name=tostring(name)\r\n| extend DisplayName = tostring(properties.displayName)\r\n| project name,DisplayName\r\n) on $left.policyAssignmentName == $right.name\r\n| project complianceState,DisplayName,scope,compliancePercentage,compliantCount,nonCompliantCount,conflictCount,exemptCount\r\n\r\n",
                          "size": 3,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{SubscriptionPicked}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "complianceState",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "compliant",
                                      "representation": "success",
                                      "text": "[\"DisplayName\"]"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "noncompliant",
                                      "representation": "4",
                                      "text": "[\"DisplayName\"]"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "unknown",
                                      "text": "[\"DisplayName\"]"
                                    }
                                  ],
                                  "customColumnWidthSetting": "47.4286ch"
                                }
                              },
                              {
                                "columnMatch": "DisplayName",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "compliancePercentage",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 0,
                                  "max": 100,
                                  "palette": "redGreen",
                                  "customColumnWidthSetting": "143px"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "maximumFractionDigits": 0
                                  }
                                }
                              },
                              {
                                "columnMatch": "policyAssignmentName",
                                "formatter": 5
                              }
                            ],
                            "sortBy": [
                              {
                                "itemKey": "$gen_thresholds_complianceState_0",
                                "sortOrder": 2
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "complianceState",
                                "label": "Policy Assignment"
                              },
                              {
                                "columnId": "DisplayName",
                                "label": "DisplayName"
                              },
                              {
                                "columnId": "scope",
                                "label": "Scope"
                              },
                              {
                                "columnId": "compliancePercentage",
                                "label": "Compliance"
                              },
                              {
                                "columnId": "compliantCount",
                                "label": "Compliant"
                              },
                              {
                                "columnId": "nonCompliantCount",
                                "label": "Non-Compliant"
                              },
                              {
                                "columnId": "conflictCount",
                                "label": "Conflict"
                              },
                              {
                                "columnId": "exemptCount",
                                "label": "Exempt"
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "$gen_thresholds_complianceState_0",
                              "sortOrder": 2
                            }
                          ]
                        },
                        "name": "query - 4"
                      }
                    ]
                  },
                  "customWidth": "90",
                  "name": "Monitoring Configuration Group",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "title": "Monitoring Data Collection",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources\r\n| where id =~ \"{HostPool}\"\r\n| extend HostPool = name\r\n| project HostPool, resourceGroup\r\n| join (\r\nresources\r\n| where resourceGroup =~ \"{ResourceGroup}\"\r\n| where type == \"microsoft.compute/virtualmachines\"\r\n| extend PowerStatus = tostring(properties.extended.instanceView.powerState.displayStatus),\r\n\tOSType = tostring(properties.storageProfile.osDisk.osType),\r\n    IdentityType = identity.type,\r\n    ComputerName = tolower(name)\r\n| where OSType == \"Windows\"\r\n| extend ResourceType=\"Virtual Machine\"\r\n| project ComputerName, id, location, resourceGroup, PowerStatus, OSType, IdentityType,ResourceType\r\n| join kind=leftouter (\r\nresources\r\n| where type contains \"microsoft.compute/virtualmachines/extensions\"\r\n| extend publisher = properties.publisher\r\n| where publisher =~ \"Microsoft.Azure.Monitor\"\r\n| parse id with * \"/virtualMachines/\" ComputerName \"/\" *\r\n| extend extensionType = properties.type, \r\n\tstatus = tostring(properties.provisioningState),\r\n\tversion = properties.typeHandlerVersion,\r\n    ComputerName = tolower(ComputerName)\r\n| project ComputerName, AMA = name, AMAStatus = status, AMAVersion = version\r\n) on ComputerName\r\n| extend AMAStatus=case(AMAStatus==\"Succeeded\",\"Installed\",\"Not Installed\")\r\n| project ComputerName, ResourceID = tolower(id),ResourceType,location, resourceGroup, OSType, PowerStatus,AMAStatus\r\n| summarize Count=count(),VMRunning = count(PowerStatus==\"VM running\"),AMAInstalled=count(AMAStatus==\"Installed\") by resourceGroup\r\n) on resourceGroup\r\n| project-away resourceGroup1",
                          "size": 0,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{SubscriptionPicked}"
                          ]
                        },
                        "conditionalVisibility": {
                          "parameterName": "selectedTab",
                          "comparison": "isEqualTo",
                          "value": "xxx"
                        },
                        "name": "RG_ResourceCount"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "Heartbeat\r\n| where ResourceGroup =~ \"{ResourceGroup}\"\r\n| where TimeGenerated >ago(90d)\r\n| where Category == \"Azure Monitor Agent\"\r\n| extend ResourceId=tolower(_ResourceId)\r\n| summarize lasthb=arg_max(TimeGenerated,*) by ResourceId\r\n| where ResourceType =~ \"virtualMachines\" or ResourceType =~ \"virtualMachineScaleSets\"\r\n| extend ResourceType = tolower(ResourceType)\r\n| extend Computer=case(ResourceType==\"virtualmachinescalesets\",split(ResourceId,\"/\")[8],Computer)\r\n| extend ResourceId = case(ResourceType==\"virtualmachinescalesets\",split(ResourceId,\"/virtualmachines/\")[0],ResourceId)\r\n| extend Computer = toupper(Computer)\r\n| distinct Computer,OSType,ResourceId,ResourceType,ResourceGroup,SubscriptionId\r\n| join kind=fullouter\r\n(\r\n//AMA Heartbeat\r\nHeartbeat\r\n| where ResourceGroup =~ \"{ResourceGroup}\"\r\n| where TimeGenerated >ago(90d)\r\n| extend ResourceType=tolower(ResourceType)\r\n| extend ResourceId = tolower(ResourceId)\r\n| where ResourceType in (\"virtualmachines\",\"virtualmachinescalesets\")\r\n| where Category == \"Azure Monitor Agent\"\r\n| extend Computer=case(ResourceType==\"virtualmachinescalesets\",split(ResourceId,\"/\")[8],Computer)\r\n| extend ResourceId = case(ResourceType==\"virtualmachinescalesets\",split(ResourceId,\"/virtualmachines/\")[0],ResourceId)\r\n| extend Computer = toupper(Computer) \r\n| summarize LastAMAHeartbeat = arg_max(TimeGenerated,ResourceId,OSType) by Computer//ResourceId, Computer,OSType\r\n| extend TimeFromNow = now() - LastAMAHeartbeat\r\n| extend AMAHeartbeat = toint(TimeFromNow / 1s)\r\n) on Computer\r\n| join kind=leftouter\r\n//VMInsights\r\n(\r\nInsightsMetrics\r\n| where Origin == \"vm.azm.ms\"\r\n| where Name != \"Heartbeat\"\r\n| extend _ResourceId = tolower(_ResourceId)\r\n| extend Computer=case(_ResourceId contains \"virtualmachinescalesets\",split(_ResourceId,\"/\")[8],Computer)\r\n| extend ResourceId = case(_ResourceId contains \"virtualmachinescalesets\",split(_ResourceId,\"/virtualmachines/\")[0],_ResourceId)\r\n| extend Computer = toupper(Computer)\r\n| where TimeGenerated > ago(2d)\r\n| summarize LastVMICollection = max(TimeGenerated) by ResourceId\r\n| extend TimeFromNow = now() - LastVMICollection\r\n| extend VMICollection = toint(TimeFromNow / 1s)\r\n) on ResourceId\r\n//AVDPerf\r\n|join kind=leftouter (\r\nPerf\r\n| where ObjectName == \"User Input Delay per Session\"\r\n| extend _ResourceId = tolower(_ResourceId)\r\n| extend Computer=case(_ResourceId contains \"virtualmachinescalesets\",split(_ResourceId,\"/\")[8],Computer)\r\n| extend ResourceId = case(_ResourceId contains \"virtualmachinescalesets\",split(_ResourceId,\"/virtualmachines/\")[0],_ResourceId)\r\n| extend Computer = toupper(Computer)\r\n| where TimeGenerated > ago(2d)\r\n| summarize LastAVDPerfCollection = max(TimeGenerated) by ResourceId\r\n| extend TimeFromNow = now() - LastAVDPerfCollection\r\n| extend AVDPerfCollection = toint(TimeFromNow / 1s)\r\n) on ResourceId\r\n//WVDDiag\r\n| join kind=leftouter (\r\nWVDAgentHealthStatus\r\n| where TimeGenerated >ago(2d)\r\n| extend ResourceId = tolower(SessionHostResourceId)\r\n| extend Computer = toupper(SessionHostName) \r\n| summarize LastWVDDiag = arg_max(TimeGenerated,ResourceId) by Computer\r\n| extend TimeFromNow = now() - LastWVDDiag\r\n| extend WVDDiag = toint(TimeFromNow / 1s)\r\n) on ResourceId\r\n| extend AMAState = case (LastAMAHeartbeat>ago(5m),\"Connected\",\"Not Connected\")\r\n| extend VMInsightsState = case (LastVMICollection>ago(5m),\"Connected\",\"Not Connected\")\r\n| extend AVDPerfState = case (LastAVDPerfCollection>ago(5m),\"Connected\",\"Not Connected\")\r\n| extend WVDDiagState = case (LastWVDDiag>ago(5m),\"Connected\",\"Not Connected\")\r\n| project Computer,ResourceType,OSType,SubscriptionId,ResourceGroup,ResourceId,AMAHeartbeat,VMICollection,AMAState,VMInsightsState,AVDPerfState,WVDDiagState\r\n| extend ResourceGroup=tolower(ResourceGroup)\r\n| summarize AMAConnectedCount=count(AMAState == \"Connected\"), VMInsightsConnectedCount=count(VMInsightsState==\"Connected\"),AVDPerfConnectedCount=count(AVDPerfState==\"Connected\"),WVDDiagConnectedCount=count(WVDDiagState==\"Connected\") by ResourceGroup",
                          "size": 0,
                          "timeContext": {
                            "durationMs": 86400000
                          },
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "sortBy": []
                        },
                        "conditionalVisibility": {
                          "parameterName": "selectedTab",
                          "comparison": "isEqualTo",
                          "value": "xxx"
                        },
                        "name": "LAW_ResourceCount"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"79a90621-8e6a-4a0c-a4d4-dcc4c4e8f09e\",\"mergeType\":\"innerunique\",\"leftTable\":\"RG_ResourceCount\",\"rightTable\":\"LAW_ResourceCount\",\"leftColumn\":\"resourceGroup\",\"rightColumn\":\"ResourceGroup\"}],\"projectRename\":[{\"originalName\":\"[RG_ResourceCount].id\",\"mergedName\":\"id\",\"fromId\":\"unknown\"},{\"originalName\":\"[RG_ResourceCount].name\",\"mergedName\":\"name\",\"fromId\":\"unknown\"},{\"originalName\":\"[RG_ResourceCount].type\",\"mergedName\":\"type\",\"fromId\":\"unknown\"},{\"originalName\":\"[RG_ResourceCount].tenantId\",\"mergedName\":\"tenantId\",\"fromId\":\"unknown\"},{\"originalName\":\"[RG_ResourceCount].kind\",\"mergedName\":\"kind\",\"fromId\":\"unknown\"},{\"originalName\":\"[RG_ResourceCount].location\",\"mergedName\":\"location\",\"fromId\":\"unknown\"},{\"originalName\":\"[RG_ResourceCount].resourceGroup\",\"mergedName\":\"resourceGroup\",\"fromId\":\"unknown\"},{\"originalName\":\"[RG_ResourceCount].subscriptionId\",\"mergedName\":\"subscriptionId\",\"fromId\":\"unknown\"},{\"originalName\":\"[RG_ResourceCount].managedBy\",\"mergedName\":\"managedBy\",\"fromId\":\"unknown\"},{\"originalName\":\"[RG_ResourceCount].sku\",\"mergedName\":\"sku\",\"fromId\":\"unknown\"},{\"originalName\":\"[RG_ResourceCount].plan\",\"mergedName\":\"plan\",\"fromId\":\"unknown\"},{\"originalName\":\"[RG_ResourceCount].properties\",\"mergedName\":\"properties\",\"fromId\":\"unknown\"},{\"originalName\":\"[RG_ResourceCount].tags\",\"mergedName\":\"tags\",\"fromId\":\"unknown\"},{\"originalName\":\"[RG_ResourceCount].identity\",\"mergedName\":\"identity\",\"fromId\":\"unknown\"},{\"originalName\":\"[RG_ResourceCount].zones\",\"mergedName\":\"zones\",\"fromId\":\"unknown\"},{\"originalName\":\"[RG_ResourceCount].extendedLocation\",\"mergedName\":\"extendedLocation\",\"fromId\":\"unknown\"},{\"originalName\":\"[RG_ResourceCount].ResourceGroup1\",\"mergedName\":\"ResourceGroup1\",\"fromId\":\"unknown\"},{\"originalName\":\"[RG_ResourceCount].ResourceGroup\",\"mergedName\":\"ResourceGroup\",\"fromId\":\"unknown\"},{\"originalName\":\"[RG_ResourceCount].resourceGroup1\",\"mergedName\":\"resourceGroup1\",\"fromId\":\"unknown\"},{\"originalName\":\"[RG_ResourceCount].HostPool\",\"mergedName\":\"HostPool\",\"fromId\":\"79a90621-8e6a-4a0c-a4d4-dcc4c4e8f09e\"},{\"originalName\":\"[RG_ResourceCount].Count\",\"mergedName\":\"Count\",\"fromId\":\"79a90621-8e6a-4a0c-a4d4-dcc4c4e8f09e\"},{\"originalName\":\"[RG_ResourceCount].VMRunning\",\"mergedName\":\"VMRunning\",\"fromId\":\"79a90621-8e6a-4a0c-a4d4-dcc4c4e8f09e\"},{\"originalName\":\"[RG_ResourceCount].AMAInstalled\",\"mergedName\":\"AMAInstalled\",\"fromId\":\"79a90621-8e6a-4a0c-a4d4-dcc4c4e8f09e\"},{\"originalName\":\"[LAW_ResourceCount].ResourceGroup\",\"mergedName\":\"ResourceGroup\",\"fromId\":\"79a90621-8e6a-4a0c-a4d4-dcc4c4e8f09e\"},{\"originalName\":\"[LAW_ResourceCount].AMAConnectedCount\",\"mergedName\":\"AMAConnectedCount\",\"fromId\":\"79a90621-8e6a-4a0c-a4d4-dcc4c4e8f09e\"},{\"originalName\":\"[LAW_ResourceCount].VMInsightsConnectedCount\",\"mergedName\":\"VMInsightsConnectedCount\",\"fromId\":\"79a90621-8e6a-4a0c-a4d4-dcc4c4e8f09e\"},{\"originalName\":\"[LAW_ResourceCount].AVDPerfConnectedCount\",\"mergedName\":\"AVDPerfConnectedCount\",\"fromId\":\"unknown\"},{\"originalName\":\"[LAW_ResourceCount].WVDDiagConnectedCount\",\"mergedName\":\"WVDDiagConnectedCount\",\"fromId\":\"unknown\"}]}",
                          "size": 3,
                          "queryType": 7,
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "resourceGroup",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Count",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "VMRunning",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "0",
                                      "representation": "4",
                                      "text": "{0}{1} / [\"Count\"]"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "1",
                                      "text": "{0}{1} / [\"Count\"]"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "AMAInstalled",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "is Empty",
                                      "representation": "4",
                                      "text": "0 / [\"Count\"]"
                                    },
                                    {
                                      "operator": "<",
                                      "thresholdValue": "[\"Count\"]",
                                      "representation": "4",
                                      "text": "{0}{1} / [\"Count\"]"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1} / [\"Count\"]"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "ResourceGroup",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "AMAConnectedCount",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "is Empty",
                                      "representation": "4",
                                      "text": "0 / [\"VMRunning\"]"
                                    },
                                    {
                                      "operator": "<",
                                      "thresholdValue": "[\"VMRunning\"]",
                                      "representation": "4",
                                      "text": "{0}{1} / [\"VMRunning\"]"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1} / [\"VMRunning\"]"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "VMInsightsConnectedCount",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "is Empty",
                                      "representation": "4",
                                      "text": "0 / [\"VMRunning\"]"
                                    },
                                    {
                                      "operator": "<",
                                      "thresholdValue": "[\"VMRunning\"]",
                                      "representation": "4",
                                      "text": "{0}{1} / [\"VMRunning\"]"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1} / [\"VMRunning\"]"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "AVDPerfConnectedCount",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "is Empty",
                                      "representation": "4",
                                      "text": "0 / [\"VMRunning\"]"
                                    },
                                    {
                                      "operator": "<",
                                      "thresholdValue": "[\"VMRunning\"]",
                                      "representation": "4",
                                      "text": "{0}{1} / [\"VMRunning\"]"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1} / [\"VMRunning\"]"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "WVDDiagConnectedCount",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "is Empty",
                                      "representation": "4",
                                      "text": "0 / [\"VMRunning\"]"
                                    },
                                    {
                                      "operator": "<",
                                      "thresholdValue": "[\"VMRunning\"]",
                                      "representation": "4",
                                      "text": "{0}{1} / [\"VMRunning\"]"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1} / [\"VMRunning\"]"
                                    }
                                  ]
                                }
                              }
                            ],
                            "sortBy": [
                              {
                                "itemKey": "HostPool",
                                "sortOrder": 1
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "resourceGroup",
                                "label": "ResourceGroup"
                              },
                              {
                                "columnId": "HostPool",
                                "label": "Host Pool"
                              },
                              {
                                "columnId": "Count",
                                "label": "Count"
                              },
                              {
                                "columnId": "VMRunning",
                                "label": "VM Running"
                              },
                              {
                                "columnId": "AMAInstalled",
                                "label": "Agent Installed"
                              },
                              {
                                "columnId": "ResourceGroup",
                                "label": "Resource Group"
                              },
                              {
                                "columnId": "AMAConnectedCount",
                                "label": "Heartbeat"
                              },
                              {
                                "columnId": "VMInsightsConnectedCount",
                                "label": "VM Insights"
                              },
                              {
                                "columnId": "AVDPerfConnectedCount",
                                "label": "AVD Performance"
                              },
                              {
                                "columnId": "WVDDiagConnectedCount",
                                "label": "AVD Diagnostics"
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "HostPool",
                              "sortOrder": 1
                            }
                          ]
                        },
                        "showPin": false,
                        "name": "Merge-ResourceCount"
                      }
                    ]
                  },
                  "customWidth": "90",
                  "name": "Monitoring Data Group",
                  "styleSettings": {
                    "showBorder": true
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "Overview"
            },
            "name": "Overview Group"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "title": "Monitoring Configuration Compliance (Azure Policy)",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{SubscriptionPicked}"
                          ],
                          "parameters": [
                            {
                              "id": "3314507e-2772-4b8e-81b7-d1efb45f82e1",
                              "version": "KqlParameterItem/1.0",
                              "name": "PolicyAssignments",
                              "label": "Policy Assignments",
                              "type": 2,
                              "isRequired": true,
                              "multiSelect": true,
                              "quote": "'",
                              "delimiter": ",",
                              "query": "policyresources\r\n| where type == \"microsoft.authorization/policyassignments\"\r\n| extend DisplayName = tostring(properties.displayName)\r\n| extend policyDefinitionId = tostring(properties.policyDefinitionId)\r\n| project name,DisplayName,policyDefinitionId\r\n| join kind=leftouter (\r\npolicyresources\r\n| where type in (\"microsoft.authorization/policydefinitions\",\"microsoft.authorization/policysetdefinitions\")\r\n| extend PolicyDefinitionName = tostring(properties.displayName)\r\n| extend name = tostring(name)\r\n| extend Category = properties.metadata.category\r\n| project PolicyDefinitionName,Category,name,id\r\n) on $left.policyDefinitionId == $right.id\r\n| where Category == \"Monitoring\"\r\n| project name,DisplayName\r\n| order by DisplayName asc",
                              "crossComponentResources": [
                                "{SubscriptionPicked}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::all"
                                ],
                                "showDefault": false
                              },
                              "defaultValue": "value::all",
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources"
                            },
                            {
                              "id": "71f72d48-b28a-473e-8285-9c47f08e90bc",
                              "version": "KqlParameterItem/1.0",
                              "name": "Compliance",
                              "type": 2,
                              "isRequired": true,
                              "multiSelect": true,
                              "quote": "'",
                              "delimiter": ",",
                              "query": "PolicyResources\r\n|wheretype=='microsoft.policyinsights/policystates'\r\n| extend ComplianceState = tostring(properties.complianceState)\r\n| distinct ComplianceState",
                              "crossComponentResources": [
                                "{SubscriptionPicked}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::all"
                                ],
                                "showDefault": false
                              },
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources",
                              "value": [
                                "NonCompliant"
                              ]
                            }
                          ],
                          "style": "pills",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources"
                        },
                        "name": "parameters - 3 - Copy - Copy - Copy"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "PolicyResources\r\n|wheretype=='microsoft.policyinsights/policystates'\r\n| extend Resource = tostring(properties.resourceId), policyAssignmentName = tostring(properties.policyAssignmentName), PolicyDefinitionReferenceID = tostring(properties.policyDefinitionReferenceId),ComplianceState = tostring(properties.complianceState)\r\n| where policyAssignmentName in ({PolicyAssignments})\r\n//|whereComplianceState=='NonCompliant'\r\n|whereComplianceStatein ({Compliance})\r\n| project Resource,policyAssignmentName,PolicyDefinitionReferenceID,ComplianceState\r\n| join kind=leftouter (\r\npolicyresources\r\n| where type == \"microsoft.authorization/policyassignments\"\r\n| extend name=tostring(name)\r\n| extend PolicyAssignmentDisplayName = tostring(properties.displayName)\r\n| extend policyDefinitionId = tostring(properties.policyDefinitionId)\r\n//| project name,PolicyAssignmentDisplayName\r\n| where PolicyAssignmentDisplayName contains \"monitor\"\r\n) on $left.policyAssignmentName == $right.name\r\n| where PolicyAssignmentDisplayName contains \"monitor\"\r\n| project Resource, policyAssignmentName,PolicyAssignmentDisplayName,PolicyDefinitionReferenceID,policyDefinitionId,ComplianceState\r\n//| project Resource,DisplayName,PolicyDefinitionReferenceID\r\n| join kind=leftouter (\r\nPolicyResources\r\n| where type in (\"microsoft.authorization/policydefinitions\",\"microsoft.authorization/policysetdefinitions\")\r\n//| where id in (\"/subscriptions/93e078d2-5dcc-4825-8290-f8fa50912c40/providers/Microsoft.Authorization/policyDefinitions/4a5867f7-bed4-4d69-aa44-30cb18fbe7ec\")\r\n| extend PolicyDisplayName = tostring(properties.displayName)\r\n| project id,PolicyDisplayName\r\n) on $left.policyDefinitionId == $right.id\r\n| extend PolicyReference = case(isempty(PolicyDefinitionReferenceID),PolicyDisplayName,PolicyDefinitionReferenceID)\r\n| project ComplianceState,Resource,PolicyAssignmentDisplayName,PolicyReference//,PolicyDefinitionReferenceID,PolicyDisplayName",
                          "size": 0,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{SubscriptionPicked}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "ComplianceState",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Compliant",
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "NonCompliant",
                                      "representation": "4",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "unknown",
                                      "text": "{0}{1}"
                                    }
                                  ],
                                  "customColumnWidthSetting": "20.7143ch"
                                }
                              },
                              {
                                "columnMatch": "Resource",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "21.7143ch"
                                }
                              },
                              {
                                "columnMatch": "PolicyAssignmentDisplayName",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "45.4286ch"
                                }
                              },
                              {
                                "columnMatch": "PolicyReference",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "50ch"
                                }
                              }
                            ],
                            "rowLimit": 1000,
                            "filter": true,
                            "sortBy": [
                              {
                                "itemKey": "$gen_link_Resource_1",
                                "sortOrder": 1
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "ComplianceState",
                                "label": "Compliant"
                              },
                              {
                                "columnId": "Resource",
                                "label": "Resource"
                              },
                              {
                                "columnId": "PolicyAssignmentDisplayName",
                                "label": "Policy Assignment"
                              },
                              {
                                "columnId": "PolicyReference",
                                "label": "Policy Name / Reference"
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "$gen_link_Resource_1",
                              "sortOrder": 1
                            }
                          ]
                        },
                        "name": "query - 0"
                      }
                    ]
                  },
                  "customWidth": "75",
                  "name": "PolicyConfigGroup",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "title": "Monitoring Data Collection",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "value::all"
                          ],
                          "parameters": [
                            {
                              "id": "b9540fc1-3197-4fd9-aecb-8b52141a6ba0",
                              "version": "KqlParameterItem/1.0",
                              "name": "PowerStatus",
                              "label": "Power Status",
                              "type": 2,
                              "isRequired": true,
                              "multiSelect": true,
                              "quote": "'",
                              "delimiter": ",",
                              "query": "resources\r\n| where type == \"microsoft.compute/virtualmachines\"\r\n| extend PowerStatus = tostring(properties.extended.instanceView.powerState.displayStatus)\r\n| distinct PowerStatus",
                              "crossComponentResources": [
                                "value::all"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::all"
                                ],
                                "showDefault": false
                              },
                              "defaultValue": "value::all",
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources",
                              "value": [
                                "value::all"
                              ]
                            },
                            {
                              "id": "d58e0b3b-ab39-4ab9-bae2-2d0bef90c82e",
                              "version": "KqlParameterItem/1.0",
                              "name": "AMAInstalled",
                              "label": "Azure Monitor Agent",
                              "type": 2,
                              "isRequired": true,
                              "multiSelect": true,
                              "quote": "'",
                              "delimiter": ",",
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::all"
                                ],
                                "showDefault": false
                              },
                              "jsonData": " [\"Installed\", \"Not Installed\"]",
                              "defaultValue": "value::all",
                              "value": [
                                "value::all"
                              ]
                            },
                            {
                              "id": "2c6102bd-89ce-49a8-9564-dc1e4245180e",
                              "version": "KqlParameterItem/1.0",
                              "name": "ShowAll",
                              "label": "Resource Filter",
                              "type": 2,
                              "query": "{\"version\":\"1.0.0\",\"content\":\" [\\\"Only Disconnected\\\", \\\"Show All\\\"]\",\"transformers\":null}",
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "queryType": 8,
                              "value": "Show All"
                            }
                          ],
                          "style": "pills",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources"
                        },
                        "name": "parameters - 3"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources\r\n| where id =~ \"{HostPool}\"\r\n| extend HostPool = name\r\n| project HostPool, resourceGroup\r\n| join (\r\nresources\r\n| where resourceGroup =~ \"{ResourceGroup}\"\r\n| where type == \"microsoft.compute/virtualmachines\"\r\n| extend PowerStatus = tostring(properties.extended.instanceView.powerState.displayStatus),\r\n\tOSType = tostring(properties.storageProfile.osDisk.osType),\r\n    IdentityType = identity.type,\r\n    ComputerName = tolower(name)\r\n| where OSType == \"Windows\"\r\n| extend ResourceType=\"Virtual Machine\"\r\n| project ComputerName, id, location, resourceGroup, PowerStatus, OSType, IdentityType,ResourceType\r\n| join kind=leftouter (\r\nresources\r\n| where type contains \"microsoft.compute/virtualmachines/extensions\"\r\n| extend publisher = properties.publisher\r\n| where publisher =~ \"Microsoft.Azure.Monitor\"\r\n| parse id with * \"/virtualMachines/\" ComputerName \"/\" *\r\n| extend extensionType = properties.type, \r\n\tstatus = tostring(properties.provisioningState),\r\n\tversion = properties.typeHandlerVersion,\r\n    ComputerName = tolower(ComputerName)\r\n| project ComputerName, AMA = name, AMAStatus = status, AMAVersion = version\r\n) on ComputerName\r\n| extend AMAStatus=case(AMAStatus==\"Succeeded\",\"Installed\",\"Not Installed\")\r\n| where (isempty(PowerStatus) or PowerStatus in ({PowerStatus})) and AMAStatus in ({AMAInstalled})\r\n) on resourceGroup\r\n| project HostPool,ComputerName, ResourceID = tolower(id),PowerStatus,AMAStatus,resourceGroup",
                          "size": 3,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "value::all"
                          ],
                          "gridSettings": {
                            "rowLimit": 500,
                            "filter": true
                          }
                        },
                        "conditionalVisibility": {
                          "parameterName": "selectedTab",
                          "comparison": "isEqualTo",
                          "value": "xxx"
                        },
                        "name": "ARG_HostPool_VMs"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "Heartbeat\r\n| where ResourceGroup =~ \"{ResourceGroup}\"\r\n| where TimeGenerated >ago(90d)\r\n| where Category == \"Azure Monitor Agent\"\r\n| extend ResourceId=tolower(_ResourceId)\r\n| summarize lasthb=arg_max(TimeGenerated,*) by ResourceId\r\n| where ResourceType =~ \"virtualMachines\" or ResourceType =~ \"virtualMachineScaleSets\"\r\n| extend ResourceType = tolower(ResourceType)\r\n| extend Computer=case(ResourceType==\"virtualmachinescalesets\",split(ResourceId,\"/\")[8],Computer)\r\n| extend ResourceId = case(ResourceType==\"virtualmachinescalesets\",split(ResourceId,\"/virtualmachines/\")[0],ResourceId)\r\n| extend Computer = toupper(Computer)\r\n| distinct Computer,OSType,ResourceId,ResourceType,ResourceGroup\r\n| join kind=fullouter\r\n(\r\n//AMA Heartbeat\r\nHeartbeat\r\n| where ResourceGroup =~ \"{ResourceGroup}\"\r\n| where TimeGenerated >ago(90d)\r\n| extend ResourceType=tolower(ResourceType)\r\n| extend ResourceId = tolower(ResourceId)\r\n| where ResourceType in (\"virtualmachines\",\"virtualmachinescalesets\")\r\n| where Category == \"Azure Monitor Agent\"\r\n| extend Computer=case(ResourceType==\"virtualmachinescalesets\",split(ResourceId,\"/\")[8],Computer)\r\n| extend ResourceId = case(ResourceType==\"virtualmachinescalesets\",split(ResourceId,\"/virtualmachines/\")[0],ResourceId)\r\n| extend Computer = toupper(Computer) \r\n| summarize LastAMAHeartbeat = arg_max(TimeGenerated,ResourceId,OSType) by Computer//ResourceId, Computer,OSType\r\n| extend TimeFromNow = now() - LastAMAHeartbeat\r\n| extend AMAHeartbeat = toint(TimeFromNow / 1s)\r\n) on Computer\r\n| join kind=leftouter\r\n//VMInsights\r\n(\r\nInsightsMetrics\r\n| where Origin == \"vm.azm.ms\"\r\n| where Name != \"Heartbeat\"\r\n| extend _ResourceId = tolower(_ResourceId)\r\n| extend Computer=case(_ResourceId contains \"virtualmachinescalesets\",split(_ResourceId,\"/\")[8],Computer)\r\n| extend ResourceId = case(_ResourceId contains \"virtualmachinescalesets\",split(_ResourceId,\"/virtualmachines/\")[0],_ResourceId)\r\n| extend Computer = toupper(Computer)\r\n| where TimeGenerated > ago(2d)\r\n| summarize LastVMICollection = max(TimeGenerated) by ResourceId\r\n| extend TimeFromNow = now() - LastVMICollection\r\n| extend VMICollection = toint(TimeFromNow / 1s)\r\n) on ResourceId\r\n//AVDPerf\r\n|join kind=leftouter (\r\nPerf\r\n| where ObjectName == \"User Input Delay per Session\"\r\n| extend _ResourceId = tolower(_ResourceId)\r\n| extend Computer=case(_ResourceId contains \"virtualmachinescalesets\",split(_ResourceId,\"/\")[8],Computer)\r\n| extend ResourceId = case(_ResourceId contains \"virtualmachinescalesets\",split(_ResourceId,\"/virtualmachines/\")[0],_ResourceId)\r\n| extend Computer = toupper(Computer)\r\n| where TimeGenerated > ago(2d)\r\n| summarize LastAVDPerfCollection = max(TimeGenerated) by ResourceId\r\n| extend TimeFromNow = now() - LastAVDPerfCollection\r\n| extend AVDPerfCollection = toint(TimeFromNow / 1s)\r\n) on ResourceId\r\n//WVDDiag\r\n| join kind=leftouter (\r\nWVDAgentHealthStatus\r\n| where TimeGenerated >ago(2d)\r\n| extend ResourceId = tolower(SessionHostResourceId)\r\n| extend Computer = toupper(SessionHostName) \r\n| summarize LastWVDDiag = arg_max(TimeGenerated,ResourceId) by Computer\r\n| extend TimeFromNow = now() - LastWVDDiag\r\n| extend WVDDiag = toint(TimeFromNow / 1s)\r\n) on ResourceId\r\n| extend AMAState = case (LastAMAHeartbeat>ago(5m),\"Connected\",\"Not Connected\")\r\n| extend VMInsightsState = case (LastVMICollection>ago(5m),\"Connected\",\"Not Connected\")\r\n| extend AVDPerfState = case (LastAVDPerfCollection>ago(5m),\"Connected\",\"Not Connected\")\r\n| extend WVDDiagState = case (LastWVDDiag>ago(5m),\"Connected\",\"Not Connected\")\r\n| where AMAState != \"Not Connected\" and VMInsightsState != \"Not Connected\" and AVDPerfState != \"Not Connected\" and WVDDiagState != \"Not Connected\"\r\n| project Computer,ResourceId,AMAHeartbeat,VMICollection,AVDPerfCollection,WVDDiag,AMAState,VMInsightsState,AVDPerfState,WVDDiagState,ResourceGroup",
                          "size": 0,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "gridSettings": {
                            "rowLimit": 1000
                          }
                        },
                        "conditionalVisibility": {
                          "parameterName": "selectedTab",
                          "comparison": "isEqualTo",
                          "value": "xxx"
                        },
                        "name": "LAWQuery-Connected"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "Heartbeat\r\n| where ResourceGroup =~ \"{ResourceGroup}\"\r\n| where TimeGenerated >ago(90d)\r\n| where Category == \"Azure Monitor Agent\"\r\n| extend ResourceId=tolower(_ResourceId)\r\n| summarize lasthb=arg_max(TimeGenerated,*) by ResourceId\r\n| where ResourceType =~ \"virtualMachines\" or ResourceType =~ \"virtualMachineScaleSets\"\r\n| extend ResourceType = tolower(ResourceType)\r\n| extend Computer=case(ResourceType==\"virtualmachinescalesets\",split(ResourceId,\"/\")[8],Computer)\r\n| extend ResourceId = case(ResourceType==\"virtualmachinescalesets\",split(ResourceId,\"/virtualmachines/\")[0],ResourceId)\r\n| extend Computer = toupper(Computer)\r\n| distinct Computer,OSType,ResourceId,ResourceType,ResourceGroup\r\n| join kind=fullouter\r\n(\r\n//AMA Heartbeat\r\nHeartbeat\r\n| where ResourceGroup =~ \"{ResourceGroup}\"\r\n| where TimeGenerated >ago(90d)\r\n| extend ResourceType=tolower(ResourceType)\r\n| extend ResourceId = tolower(ResourceId)\r\n| where ResourceType in (\"virtualmachines\",\"virtualmachinescalesets\")\r\n| where Category == \"Azure Monitor Agent\"\r\n| extend Computer=case(ResourceType==\"virtualmachinescalesets\",split(ResourceId,\"/\")[8],Computer)\r\n| extend ResourceId = case(ResourceType==\"virtualmachinescalesets\",split(ResourceId,\"/virtualmachines/\")[0],ResourceId)\r\n| extend Computer = toupper(Computer) \r\n| summarize LastAMAHeartbeat = arg_max(TimeGenerated,ResourceId,OSType) by Computer//ResourceId, Computer,OSType\r\n| extend TimeFromNow = now() - LastAMAHeartbeat\r\n| extend AMAHeartbeat = toint(TimeFromNow / 1s)\r\n) on Computer\r\n| join kind=leftouter\r\n//VMInsights\r\n(\r\nInsightsMetrics\r\n| where Origin == \"vm.azm.ms\"\r\n| where Name != \"Heartbeat\"\r\n| extend _ResourceId = tolower(_ResourceId)\r\n| extend Computer=case(_ResourceId contains \"virtualmachinescalesets\",split(_ResourceId,\"/\")[8],Computer)\r\n| extend ResourceId = case(_ResourceId contains \"virtualmachinescalesets\",split(_ResourceId,\"/virtualmachines/\")[0],_ResourceId)\r\n| extend Computer = toupper(Computer)\r\n| where TimeGenerated > ago(2d)\r\n| summarize LastVMICollection = max(TimeGenerated) by ResourceId\r\n| extend TimeFromNow = now() - LastVMICollection\r\n| extend VMICollection = toint(TimeFromNow / 1s)\r\n) on ResourceId\r\n//AVDPerf\r\n|join kind=leftouter (\r\nPerf\r\n| where ObjectName == \"User Input Delay per Session\"\r\n| extend _ResourceId = tolower(_ResourceId)\r\n| extend Computer=case(_ResourceId contains \"virtualmachinescalesets\",split(_ResourceId,\"/\")[8],Computer)\r\n| extend ResourceId = case(_ResourceId contains \"virtualmachinescalesets\",split(_ResourceId,\"/virtualmachines/\")[0],_ResourceId)\r\n| extend Computer = toupper(Computer)\r\n| where TimeGenerated > ago(2d)\r\n| summarize LastAVDPerfCollection = max(TimeGenerated) by ResourceId\r\n| extend TimeFromNow = now() - LastAVDPerfCollection\r\n| extend AVDPerfCollection = toint(TimeFromNow / 1s)\r\n) on ResourceId\r\n//WVDDiag\r\n| join kind=leftouter (\r\nWVDAgentHealthStatus\r\n| where TimeGenerated >ago(2d)\r\n| extend ResourceId = tolower(SessionHostResourceId)\r\n| extend Computer = toupper(SessionHostName) \r\n| summarize LastWVDDiag = arg_max(TimeGenerated,ResourceId) by Computer\r\n| extend TimeFromNow = now() - LastWVDDiag\r\n| extend WVDDiag = toint(TimeFromNow / 1s)\r\n) on ResourceId\r\n| extend AMAState = case (LastAMAHeartbeat>ago(5m),\"Connected\",\"Not Connected\")\r\n| extend VMInsightsState = case (LastVMICollection>ago(5m),\"Connected\",\"Not Connected\")\r\n| extend AVDPerfState = case (LastAVDPerfCollection>ago(5m),\"Connected\",\"Not Connected\")\r\n| extend WVDDiagState = case (LastWVDDiag>ago(5m),\"Connected\",\"Not Connected\")| extend AMAState = case (LastAMAHeartbeat>ago(5m),\"Connected\",\"Not Connected\")\r\n| project Computer,ResourceId,AMAHeartbeat,VMICollection,AVDPerfCollection,WVDDiag,AMAState,VMInsightsState,AVDPerfState,WVDDiagState,ResourceGroup",
                          "size": 0,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "gridSettings": {
                            "rowLimit": 1000
                          }
                        },
                        "conditionalVisibility": {
                          "parameterName": "selectedTab",
                          "comparison": "isEqualTo",
                          "value": "xxx"
                        },
                        "name": "LAWQuery-ShowAll"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "Heartbeat\r\n| where ResourceGroup =~ \"{ResourceGroup}\"\r\n| where TimeGenerated >ago(90d)\r\n| where Category == \"Azure Monitor Agent\"\r\n| extend ResourceId=tolower(_ResourceId)\r\n| summarize lasthb=arg_max(TimeGenerated,*) by ResourceId\r\n| where ResourceType =~ \"virtualMachines\" or ResourceType =~ \"virtualMachineScaleSets\"\r\n| extend ResourceType = tolower(ResourceType)\r\n| extend Computer=case(ResourceType==\"virtualmachinescalesets\",split(ResourceId,\"/\")[8],Computer)\r\n| extend ResourceId = case(ResourceType==\"virtualmachinescalesets\",split(ResourceId,\"/virtualmachines/\")[0],ResourceId)\r\n| extend Computer = toupper(Computer)\r\n| distinct Computer,OSType,ResourceId,ResourceType,ResourceGroup\r\n| join kind=fullouter\r\n(\r\n//AMA Heartbeat\r\nHeartbeat\r\n| where ResourceGroup =~ \"{ResourceGroup}\"\r\n| where TimeGenerated >ago(90d)\r\n| extend ResourceType=tolower(ResourceType)\r\n| extend ResourceId = tolower(ResourceId)\r\n| where ResourceType in (\"virtualmachines\",\"virtualmachinescalesets\")\r\n| where Category == \"Azure Monitor Agent\"\r\n| extend Computer=case(ResourceType==\"virtualmachinescalesets\",split(ResourceId,\"/\")[8],Computer)\r\n| extend ResourceId = case(ResourceType==\"virtualmachinescalesets\",split(ResourceId,\"/virtualmachines/\")[0],ResourceId)\r\n| extend Computer = toupper(Computer) \r\n| summarize LastAMAHeartbeat = arg_max(TimeGenerated,ResourceId,OSType) by Computer//ResourceId, Computer,OSType\r\n| extend TimeFromNow = now() - LastAMAHeartbeat\r\n| extend AMAHeartbeat = toint(TimeFromNow / 1s)\r\n) on Computer\r\n| join kind=leftouter\r\n//VMInsights\r\n(\r\nInsightsMetrics\r\n| where Origin == \"vm.azm.ms\"\r\n| where Name != \"Heartbeat\"\r\n| extend _ResourceId = tolower(_ResourceId)\r\n| extend Computer=case(_ResourceId contains \"virtualmachinescalesets\",split(_ResourceId,\"/\")[8],Computer)\r\n| extend ResourceId = case(_ResourceId contains \"virtualmachinescalesets\",split(_ResourceId,\"/virtualmachines/\")[0],_ResourceId)\r\n| extend Computer = toupper(Computer)\r\n| where TimeGenerated > ago(2d)\r\n| summarize LastVMICollection = max(TimeGenerated) by ResourceId\r\n| extend TimeFromNow = now() - LastVMICollection\r\n| extend VMICollection = toint(TimeFromNow / 1s)\r\n) on ResourceId\r\n//AVDPerf\r\n|join kind=leftouter (\r\nPerf\r\n| where ObjectName == \"User Input Delay per Session\"\r\n| extend _ResourceId = tolower(_ResourceId)\r\n| extend Computer=case(_ResourceId contains \"virtualmachinescalesets\",split(_ResourceId,\"/\")[8],Computer)\r\n| extend ResourceId = case(_ResourceId contains \"virtualmachinescalesets\",split(_ResourceId,\"/virtualmachines/\")[0],_ResourceId)\r\n| extend Computer = toupper(Computer)\r\n| where TimeGenerated > ago(2d)\r\n| summarize LastAVDPerfCollection = max(TimeGenerated) by ResourceId\r\n| extend TimeFromNow = now() - LastAVDPerfCollection\r\n| extend AVDPerfCollection = toint(TimeFromNow / 1s)\r\n) on ResourceId\r\n//WVDDiag\r\n| join kind=leftouter (\r\nWVDAgentHealthStatus\r\n| where TimeGenerated >ago(2d)\r\n| extend ResourceId = tolower(SessionHostResourceId)\r\n| extend Computer = toupper(SessionHostName) \r\n| summarize LastWVDDiag = arg_max(TimeGenerated,ResourceId) by Computer\r\n| extend TimeFromNow = now() - LastWVDDiag\r\n| extend WVDDiag = toint(TimeFromNow / 1s)\r\n) on ResourceId\r\n| extend AMAState = case (LastAMAHeartbeat>ago(5m),\"Connected\",\"Not Connected\")\r\n| extend VMInsightsState = case (LastVMICollection>ago(5m),\"Connected\",\"Not Connected\")\r\n| extend AVDPerfState = case (LastAVDPerfCollection>ago(5m),\"Connected\",\"Not Connected\")\r\n| extend WVDDiagState = case (LastWVDDiag>ago(5m),\"Connected\",\"Not Connected\")\r\n| where AMAState == \"Not Connected\" or VMInsightsState == \"Not Connected\" or AVDPerfState == \"Not Connected\" or WVDDiagState == \"Not Connected\"\r\n| project Computer,ResourceId,AMAHeartbeat,VMICollection,AVDPerfCollection,WVDDiag,AMAState,VMInsightsState,AVDPerfState,WVDDiagState,ResourceGroup",
                          "size": 0,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ]
                        },
                        "conditionalVisibility": {
                          "parameterName": "selectedTab",
                          "comparison": "isEqualTo",
                          "value": "xxx"
                        },
                        "name": "LAWQuery - Disconnected"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"3e20269b-01eb-4fe1-b331-9af0e6e4512a\",\"mergeType\":\"leftanti\",\"leftTable\":\"ARG_HostPool_VMs\",\"rightTable\":\"LAWQuery-Connected\",\"leftColumn\":\"ResourceID\",\"rightColumn\":\"ResourceId\"},{\"id\":\"3e20269b-01eb-4fe1-b331-9af0e6e4512b\",\"mergeType\":\"leftouter\",\"leftTable\":\"ARG_HostPool_VMs\",\"rightTable\":\"LAWQuery - Disconnected\",\"leftColumn\":\"ResourceID\",\"rightColumn\":\"ResourceId\"}],\"projectRename\":[{\"originalName\":\"[VMlist].AMAStatus\",\"mergedName\":\"AMAStatus\",\"fromId\":\"unknown\"},{\"originalName\":\"[ARG_HostPool_VMs].HostPool\",\"mergedName\":\"HostPool\",\"fromId\":\"3e20269b-01eb-4fe1-b331-9af0e6e4512a\"},{\"originalName\":\"[ARG_HostPool_VMs].ComputerName\",\"mergedName\":\"ComputerName\",\"fromId\":\"3e20269b-01eb-4fe1-b331-9af0e6e4512a\"},{\"originalName\":\"[ARG_HostPool_VMs].ResourceID\",\"mergedName\":\"ResourceID\",\"fromId\":\"3e20269b-01eb-4fe1-b331-9af0e6e4512a\"},{\"originalName\":\"[ARG_HostPool_VMs].PowerStatus\",\"mergedName\":\"PowerStatus\",\"fromId\":\"3e20269b-01eb-4fe1-b331-9af0e6e4512a\"},{\"originalName\":\"[ARG_HostPool_VMs].AMAStatus\",\"mergedName\":\"AMAStatus\",\"fromId\":\"3e20269b-01eb-4fe1-b331-9af0e6e4512a\"},{\"originalName\":\"[LAWQuery - Disconnected].Computer\",\"mergedName\":\"Computer\",\"fromId\":\"3e20269b-01eb-4fe1-b331-9af0e6e4512b\"},{\"originalName\":\"[LAWQuery - Disconnected].ResourceId\",\"mergedName\":\"ResourceId\",\"fromId\":\"3e20269b-01eb-4fe1-b331-9af0e6e4512b\"},{\"originalName\":\"[LAWQuery - Disconnected].AMAHeartbeat\",\"mergedName\":\"AMAHeartbeat\",\"fromId\":\"3e20269b-01eb-4fe1-b331-9af0e6e4512b\"},{\"originalName\":\"[LAWQuery - Disconnected].VMICollection\",\"mergedName\":\"VMICollection\",\"fromId\":\"3e20269b-01eb-4fe1-b331-9af0e6e4512b\"},{\"originalName\":\"[LAWQuery - Disconnected].AMAState\",\"mergedName\":\"AMAState\",\"fromId\":\"3e20269b-01eb-4fe1-b331-9af0e6e4512b\"},{\"originalName\":\"[LAWQuery - Disconnected].VMInsightsState\",\"mergedName\":\"VMInsightsState\",\"fromId\":\"3e20269b-01eb-4fe1-b331-9af0e6e4512b\"},{\"originalName\":\"[ARG_HostPool_VMs].resourceGroup\",\"mergedName\":\"resourceGroup\",\"fromId\":\"unknown\"},{\"originalName\":\"[LAWQuery - Disconnected].ResourceGroup\",\"mergedName\":\"ResourceGroup\",\"fromId\":\"unknown\"},{\"originalName\":\"[LAWQuery - Disconnected].AVDPerfState\",\"mergedName\":\"AVDPerfState\",\"fromId\":\"unknown\"},{\"originalName\":\"[LAWQuery - Disconnected].WVDDiagState\",\"mergedName\":\"WVDDiagState\",\"fromId\":\"unknown\"},{\"originalName\":\"[LAWQuery - Disconnected].AVDPerfCollection\",\"mergedName\":\"AVDPerfCollection\",\"fromId\":\"unknown\"},{\"originalName\":\"[LAWQuery - Disconnected].WVDDiag\",\"mergedName\":\"WVDDiag\",\"fromId\":\"unknown\"},{\"originalName\":\"[LAWQuery - Disconnected].Computer\"},{\"originalName\":\"[LAWQuery - Disconnected].ResourceId\"}]}",
                          "size": 0,
                          "queryType": 7,
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "ComputerName",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "ResourceID",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "21ch"
                                }
                              },
                              {
                                "columnMatch": "AMAStatus",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Installed",
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Not Installed",
                                      "representation": "4",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "unknown",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "Computer",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "ResourceId",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "AMAHeartbeat",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "is Empty",
                                      "representation": "4",
                                      "text": "None"
                                    },
                                    {
                                      "operator": ">",
                                      "thresholdValue": "300",
                                      "representation": "4",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                },
                                "numberFormat": {
                                  "unit": 24,
                                  "options": {
                                    "style": "decimal",
                                    "maximumFractionDigits": 0
                                  }
                                }
                              },
                              {
                                "columnMatch": "VMICollection",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "is Empty",
                                      "representation": "4",
                                      "text": "None"
                                    },
                                    {
                                      "operator": ">",
                                      "thresholdValue": "300",
                                      "representation": "4",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                },
                                "numberFormat": {
                                  "unit": 24,
                                  "options": {
                                    "style": "decimal",
                                    "maximumFractionDigits": 0
                                  }
                                }
                              },
                              {
                                "columnMatch": "AMAState",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "VMInsightsState",
                                "formatter": 5,
                                "numberFormat": {
                                  "unit": 24,
                                  "options": {
                                    "style": "decimal",
                                    "maximumFractionDigits": 0
                                  }
                                }
                              },
                              {
                                "columnMatch": "resourceGroup",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "ResourceGroup",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "AVDPerfState",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "WVDDiagState",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "AVDPerfCollection",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "is Empty",
                                      "representation": "4",
                                      "text": "None"
                                    },
                                    {
                                      "operator": ">",
                                      "thresholdValue": "300",
                                      "representation": "4",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                },
                                "numberFormat": {
                                  "unit": 24,
                                  "options": {
                                    "style": "decimal",
                                    "minimumFractionDigits": 0
                                  }
                                }
                              },
                              {
                                "columnMatch": "WVDDiag",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "is Empty",
                                      "representation": "4",
                                      "text": "None"
                                    },
                                    {
                                      "operator": ">",
                                      "thresholdValue": "300",
                                      "representation": "4",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                },
                                "numberFormat": {
                                  "unit": 24,
                                  "options": {
                                    "style": "decimal",
                                    "minimumFractionDigits": 0
                                  }
                                }
                              }
                            ],
                            "rowLimit": 1000,
                            "filter": true,
                            "sortBy": [
                              {
                                "itemKey": "PowerStatus",
                                "sortOrder": 1
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "HostPool",
                                "label": "Host Pool"
                              },
                              {
                                "columnId": "ComputerName",
                                "label": "Computer Name"
                              },
                              {
                                "columnId": "ResourceID",
                                "label": "Azure Resource"
                              },
                              {
                                "columnId": "PowerStatus",
                                "label": "Power Status"
                              },
                              {
                                "columnId": "AMAStatus",
                                "label": "Azure Monitor Agent"
                              },
                              {
                                "columnId": "Computer",
                                "label": "Computer"
                              },
                              {
                                "columnId": "ResourceId",
                                "label": "ResourceId"
                              },
                              {
                                "columnId": "AMAHeartbeat",
                                "label": "Heartbeat"
                              },
                              {
                                "columnId": "VMICollection",
                                "label": "VM Insights"
                              },
                              {
                                "columnId": "AMAState",
                                "label": "AMAState"
                              },
                              {
                                "columnId": "VMInsightsState",
                                "label": "VMInsightsState"
                              },
                              {
                                "columnId": "resourceGroup",
                                "label": "resourceGroup"
                              },
                              {
                                "columnId": "ResourceGroup",
                                "label": "ResourceGroup"
                              },
                              {
                                "columnId": "AVDPerfState",
                                "label": "AVDPerfState"
                              },
                              {
                                "columnId": "WVDDiagState",
                                "label": "WVDDiagState"
                              },
                              {
                                "columnId": "AVDPerfCollection",
                                "label": "AVD Performance"
                              },
                              {
                                "columnId": "WVDDiag",
                                "label": "AVD Diagnostics"
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "PowerStatus",
                              "sortOrder": 1
                            }
                          ]
                        },
                        "conditionalVisibility": {
                          "parameterName": "ShowAll",
                          "comparison": "isEqualTo",
                          "value": "Only Disconnected"
                        },
                        "showPin": false,
                        "name": "Merge - DisconnectedOnly"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"3e20269b-01eb-4fe1-b331-9af0e6e451c3\",\"mergeType\":\"leftouter\",\"leftTable\":\"ARG_HostPool_VMs\",\"rightTable\":\"LAWQuery-ShowAll\",\"leftColumn\":\"ResourceID\",\"rightColumn\":\"ResourceId\"}],\"projectRename\":[{\"originalName\":\"[ARG_HostPool_VMs].HostPool\",\"mergedName\":\"HostPool\",\"fromId\":\"3e20269b-01eb-4fe1-b331-9af0e6e451c3\"},{\"originalName\":\"[LAWQuery-ShowAll].Computer\",\"mergedName\":\"Computer\",\"fromId\":\"3e20269b-01eb-4fe1-b331-9af0e6e451c3\"},{\"originalName\":\"[ARG_HostPool_VMs].ComputerName\",\"mergedName\":\"ComputerName\",\"fromId\":\"3e20269b-01eb-4fe1-b331-9af0e6e451c3\"},{\"originalName\":\"[ARG_HostPool_VMs].ResourceID\",\"mergedName\":\"ResourceID\",\"fromId\":\"3e20269b-01eb-4fe1-b331-9af0e6e451c3\"},{\"originalName\":\"[ARG_HostPool_VMs].PowerStatus\",\"mergedName\":\"PowerStatus\",\"fromId\":\"3e20269b-01eb-4fe1-b331-9af0e6e451c3\"},{\"originalName\":\"[ARG_HostPool_VMs].AMAStatus\",\"mergedName\":\"AMAStatus\",\"fromId\":\"3e20269b-01eb-4fe1-b331-9af0e6e451c3\"},{\"originalName\":\"[LAWQuery-ShowAll].AMAHeartbeat\",\"mergedName\":\"AMAHeartbeat\",\"fromId\":\"3e20269b-01eb-4fe1-b331-9af0e6e451c3\"},{\"originalName\":\"[LAWQuery-ShowAll].VMICollection\",\"mergedName\":\"VMICollection\",\"fromId\":\"3e20269b-01eb-4fe1-b331-9af0e6e451c3\"},{\"originalName\":\"[LAWQuery-ShowAll].AMAState\",\"mergedName\":\"AMAState\",\"fromId\":\"3e20269b-01eb-4fe1-b331-9af0e6e451c3\"},{\"originalName\":\"[LAWQuery-ShowAll].VMInsightsState\",\"mergedName\":\"VMInsightsState\",\"fromId\":\"3e20269b-01eb-4fe1-b331-9af0e6e451c3\"},{\"originalName\":\"[ARG_HostPool_VMs].resourceGroup\",\"mergedName\":\"resourceGroup\",\"fromId\":\"unknown\"},{\"originalName\":\"[LAWQuery-ShowAll].ResourceGroup\",\"mergedName\":\"ResourceGroup\",\"fromId\":\"unknown\"},{\"originalName\":\"[LAWQuery-ShowAll].AVDPerfState\",\"mergedName\":\"AVDPerfState\",\"fromId\":\"unknown\"},{\"originalName\":\"[LAWQuery-ShowAll].WVDDiagState\",\"mergedName\":\"WVDDiagState\",\"fromId\":\"unknown\"},{\"originalName\":\"[LAWQuery-ShowAll].AVDPerfCollection\",\"mergedName\":\"AVDPerfCollection\",\"fromId\":\"unknown\"},{\"originalName\":\"[LAWQuery-ShowAll].WVDDiag\",\"mergedName\":\"WVDDiag\",\"fromId\":\"unknown\"},{\"originalName\":\"[LAWQuery-ShowAll].ResourceId\"}]}",
                          "size": 0,
                          "queryType": 7,
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Computer",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "ComputerName",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "ResourceID",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "21ch"
                                }
                              },
                              {
                                "columnMatch": "AMAStatus",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Installed",
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Not Installed",
                                      "representation": "4",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "unknown",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "AMAHeartbeat",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "is Empty",
                                      "representation": "4",
                                      "text": "None"
                                    },
                                    {
                                      "operator": ">",
                                      "thresholdValue": "300",
                                      "representation": "4",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                },
                                "numberFormat": {
                                  "unit": 24,
                                  "options": {
                                    "style": "decimal",
                                    "maximumFractionDigits": 0
                                  }
                                }
                              },
                              {
                                "columnMatch": "VMICollection",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "is Empty",
                                      "representation": "4",
                                      "text": "None"
                                    },
                                    {
                                      "operator": ">",
                                      "thresholdValue": "300",
                                      "representation": "4",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                },
                                "numberFormat": {
                                  "unit": 24,
                                  "options": {
                                    "style": "decimal",
                                    "maximumFractionDigits": 0
                                  }
                                }
                              },
                              {
                                "columnMatch": "AMAState",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "VMInsightsState",
                                "formatter": 5,
                                "numberFormat": {
                                  "unit": 24,
                                  "options": {
                                    "style": "decimal",
                                    "maximumFractionDigits": 0
                                  }
                                }
                              },
                              {
                                "columnMatch": "resourceGroup",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "ResourceGroup",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "AVDPerfState",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "WVDDiagState",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "AVDPerfCollection",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "is Empty",
                                      "representation": "4",
                                      "text": "None"
                                    },
                                    {
                                      "operator": ">",
                                      "thresholdValue": "300",
                                      "representation": "4",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                },
                                "numberFormat": {
                                  "unit": 24,
                                  "options": {
                                    "style": "decimal",
                                    "minimumFractionDigits": 0
                                  }
                                }
                              },
                              {
                                "columnMatch": "WVDDiag",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "is Empty",
                                      "representation": "4",
                                      "text": "None"
                                    },
                                    {
                                      "operator": ">",
                                      "thresholdValue": "300",
                                      "representation": "4",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                },
                                "numberFormat": {
                                  "unit": 24,
                                  "options": {
                                    "style": "decimal",
                                    "maximumFractionDigits": 0
                                  }
                                }
                              }
                            ],
                            "rowLimit": 1000,
                            "filter": true,
                            "sortBy": [
                              {
                                "itemKey": "$gen_link_ResourceID_3",
                                "sortOrder": 1
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "HostPool",
                                "label": "Host Pool"
                              },
                              {
                                "columnId": "Computer",
                                "label": "Computer"
                              },
                              {
                                "columnId": "ComputerName",
                                "label": "Computer Name"
                              },
                              {
                                "columnId": "ResourceID",
                                "label": "ResourceID"
                              },
                              {
                                "columnId": "PowerStatus",
                                "label": "Power Status"
                              },
                              {
                                "columnId": "AMAStatus",
                                "label": "Azure Monitor Agent"
                              },
                              {
                                "columnId": "AMAHeartbeat",
                                "label": "Heartbeat"
                              },
                              {
                                "columnId": "VMICollection",
                                "label": "VM Insights Data"
                              },
                              {
                                "columnId": "AMAState",
                                "label": "AMAState"
                              },
                              {
                                "columnId": "VMInsightsState",
                                "label": "VMInsightsState"
                              },
                              {
                                "columnId": "resourceGroup",
                                "label": "resourceGroup"
                              },
                              {
                                "columnId": "ResourceGroup",
                                "label": "ResourceGroup"
                              },
                              {
                                "columnId": "AVDPerfState",
                                "label": "AVDPerfState"
                              },
                              {
                                "columnId": "WVDDiagState",
                                "label": "WVDDiagState"
                              },
                              {
                                "columnId": "AVDPerfCollection",
                                "label": "AVD Performance"
                              },
                              {
                                "columnId": "WVDDiag",
                                "label": "AVD Diagnostic"
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "$gen_link_ResourceID_3",
                              "sortOrder": 1
                            }
                          ]
                        },
                        "conditionalVisibility": {
                          "parameterName": "ShowAll",
                          "comparison": "isEqualTo",
                          "value": "Show All"
                        },
                        "showPin": false,
                        "name": "Merge - ShowAll"
                      }
                    ]
                  },
                  "name": "VMsBySubscriptionGroup",
                  "styleSettings": {
                    "showBorder": true
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "Details"
            },
            "name": "Details Group"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "monitoring"
      },
      "name": "VM_Group"
    }
  ],
  "fallbackResourceIds": [
    "Microsoft_Azure_WVD"
  ],
  "fromTemplateId": "community-Workbooks/Windows Virtual Desktop/WVD Insights",
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}